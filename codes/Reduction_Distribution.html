<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="description" />
<meta name="keywords" content="keywords" />
<meta name="author" content="author" />
<link rel="stylesheet" type="text/css" href="pagestyle.css" />
<title>Arman Akbarian's Homepage</title>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>
<div class="page">
  <div class="page2">
     <div style="width:100%;height:1px;font-family: Tahoma; font-size: 1pt;"></div>
     <div  class ="header">
		
	     <div class="title">

			Arman Akbarian
			<div class="subtitle">UNIVERSITY OF BRITISH COLUMBIA <br /> PHYSICS &amp; ASTRONOMY DEPT. </div>
	</div> <!-- End of title -->
		<div class="sidebar">
         	<div class="sider">
               <p><a href="Home.html">Home <img src="img/home.svg" width="11px" /></a>
<a href="Research.html">Research <img src="img/beaker.svg" width="11px" /></a>
<a href="Publications.html">Publications <img src="img/pencil.svg" width="11px" /></a>
<a target="_blank" href="http://laplace.phas.ubc.ca/">Group Page <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/people.svg" width="11px" /></a>
<a href="Contact.html">Contact <img src="img/envelope-closed.svg" width="11px" /></a>
<a href="CV.html">CV <img src="img/person.svg" width="11px" /></a></p>

<hr />

<p><a href="Links.html">Links <img src="img/link.svg" width="11px" /></a>
<a href="Learn-By-Examples.html">Programming <img src="img/code.svg" width="11px"/></a>
<a target="_blank" href="FD_doc">FD Toolkit <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/graph.svg" width="11px" /></a>
<a target="_blank" href="sg">Web Template <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/globe.svg" width="11px" /></a>
<a href="http://rmanak.github.io/notes">Miscellany <img src="img/layers.svg" width="11px" /></a></p>

             </div>
         </div> <!--End of Sidebar -->


     </div> <!-- end header -->
	
     <!--This line is for future use -->   <div style="text-align:center; padding-top:10px; padding-bottom:10px;"></div>
	      
     <!--This line is for compatibility issues --> <div style="width:100%;height:5px;font-family: Tahoma; font-size: 1pt;"></div>
     <!--in class page2 -->
     <div class="postandside">
		        <div class="content">
            <div class="post">
              <font color="#0000ff">/*</font><br>
<font color="#0000ff">&nbsp;* Reduces function T from a 2 D grid by summing over y direction into a 1 D grid</font><br>
<font color="#0000ff">&nbsp;* Following the standards of PAMR</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
<font color="#2e8b57"><b>void</b></font>&nbsp;Reduce(<font color="#2e8b57"><b>double</b></font>&nbsp;*T, <font color="#2e8b57"><b>double</b></font>&nbsp;*T_r) {<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;rc;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;source, dest, tag;<br>
&nbsp;&nbsp; MPI_Status stat;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;loc_shape[<font color="#ff00ff">2</font>];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>double</b></font>&nbsp;loc_x;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;j, shift;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>double</b></font>&nbsp;loc_T[<font color="#ff00ff">2000</font>];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;T_r_filled[<font color="#ff00ff">2000</font>];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;loc_phys_bdy[<font color="#ff00ff">4</font>];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;loc_ghost_width[<font color="#ff00ff">4</font>];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;left_s, right_s;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;ltrace = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;i;<br>
&nbsp;&nbsp; source = my_rank;<br>
&nbsp;&nbsp; dest = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp; tag = my_rank + <font color="#ff00ff">100</font>;<br>
&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">******************* MPI SEND ***********************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; rc = MPI_Send(&amp;shape[<font color="#ff00ff">0</font>],<font color="#ff00ff">2</font>,MPI_INT,dest,tag,MPI_COMM_WORLD); <br>
&nbsp;&nbsp; rc = MPI_Send(&amp;x[<font color="#ff00ff">0</font>],<font color="#ff00ff">1</font>,MPI_DOUBLE,dest,tag,MPI_COMM_WORLD); <br>
&nbsp;&nbsp; rc = MPI_Send(&amp;T[<font color="#ff00ff">0</font>],shape[<font color="#ff00ff">0</font>],MPI_DOUBLE,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp; rc = MPI_Send(&amp;phys_bdy[<font color="#ff00ff">0</font>],<font color="#ff00ff">4</font>,MPI_INT,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp; rc = MPI_Send(&amp;ghost_width[<font color="#ff00ff">0</font>],<font color="#ff00ff">4</font>,MPI_INT,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">******************END OF MPI SEND ********************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(my_rank == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my_zero(T_r,Nx_r);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(ltrace) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my_zero_i(T_r_filled,<font color="#ff00ff">2000</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>for</b></font>&nbsp;(i=<font color="#ff00ff">0</font>; i&lt;numprocs; i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source = i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = i + <font color="#ff00ff">100</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">************ MPI RECEIVE *********************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = MPI_Recv(&amp;loc_shape[<font color="#ff00ff">0</font>], <font color="#ff00ff">2</font>, MPI_INT,source, tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_COMM_WORLD,&amp;stat); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;loc_x, <font color="#ff00ff">1</font>, MPI_DOUBLE,source, tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_COMM_WORLD,&amp;stat); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = MPI_Recv(&amp;loc_T[<font color="#ff00ff">0</font>],loc_shape[<font color="#ff00ff">0</font>],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_DOUBLE,source,tag, MPI_COMM_WORLD,&amp;stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;loc_phys_bdy[<font color="#ff00ff">0</font>],<font color="#ff00ff">4</font>,MPI_INT,source,tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_COMM_WORLD,&amp;stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;loc_ghost_width[<font color="#ff00ff">0</font>],<font color="#ff00ff">4</font>,MPI_INT,source,tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_COMM_WORLD,&amp;stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">**************** END OF MPI RECEIVE ************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shift = round( (loc_x - base_bbox[<font color="#ff00ff">0</font>] ) / dx );<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if</b></font>&nbsp;(loc_phys_bdy[<font color="#ff00ff">0</font>] == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; left_s = loc_ghost_width[<font color="#ff00ff">0</font>];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#a52a2a"><b>else</b></font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; left_s = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if</b></font>&nbsp;(loc_phys_bdy[<font color="#ff00ff">1</font>] == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">//note that CPU's have one grid point in common</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">//even without any ghost cells, that's why</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">//I have +1 here:</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; right_s = loc_ghost_width[<font color="#ff00ff">1</font>] + <font color="#ff00ff">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <font color="#a52a2a"><b>else</b></font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;right_s = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if</b></font>&nbsp;(ltrace ) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;</font><font color="#6a5acd">\n</font><font color="#ff00ff">====================</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;from CPU: </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,source);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;shift = </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,shift);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;loc_shape = </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;x </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>, loc_shape[<font color="#ff00ff">0</font>], loc_shape[<font color="#ff00ff">1</font>]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;left_s = </font><font color="#6a5acd">%d</font><font color="#ff00ff">, right_s = </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,left_s,right_s);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;====================</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>(j=left_s;j&lt;loc_shape[<font color="#ff00ff">0</font>]-right_s;j++){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T_r[j+shift] += loc_T[j];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(ltrace) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; T_r_filled[j+shift]++;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <font color="#0000ff">//End of binning from all procs</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(ltrace) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;( j=<font color="#ff00ff">0</font>; j&lt;Nx_r;j++ ){ printf(<font color="#ff00ff">&quot;</font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;&nbsp; &quot;</font>, T_r_filled[j]); }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#0000ff">//End of rank=0 job</font><br>
}<br>
<br>
<font color="#0000ff">/*</font><br>
<font color="#0000ff">&nbsp;* Distributes a 1 D data to 2 D grids according to the position of each chunck of</font><br>
<font color="#0000ff">&nbsp;* 2D grid on each CPU. Following the standards of PAMR</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
<br>
<font color="#2e8b57"><b>void</b></font>&nbsp;Distribute(<font color="#2e8b57"><b>double</b></font>&nbsp;*f_r, <font color="#2e8b57"><b>double</b></font>&nbsp;*f) {<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;rc;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;source, dest, tag;<br>
&nbsp;&nbsp; MPI_Status stat;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;loc_shape[<font color="#ff00ff">2</font>];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>double</b></font>&nbsp;loc_x;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;shift;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;ltrace = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;i;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;k;<br>
&nbsp;&nbsp; source = my_rank;<br>
&nbsp;&nbsp; dest = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp; tag = my_rank + <font color="#ff00ff">100</font>;<br>
&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">******************* MPI SEND ***********************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; rc = MPI_Send(&amp;shape[<font color="#ff00ff">0</font>],<font color="#ff00ff">2</font>,MPI_INT,dest,tag,MPI_COMM_WORLD); <br>
&nbsp;&nbsp; rc = MPI_Send(&amp;x[<font color="#ff00ff">0</font>],<font color="#ff00ff">1</font>,MPI_DOUBLE,dest,tag,MPI_COMM_WORLD); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">******************END OF MPI SEND ********************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if</b></font>&nbsp;(my_rank == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;(i=<font color="#ff00ff">0</font>; i&lt;numprocs; i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source = i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = i + <font color="#ff00ff">100</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">************ MPI RECEIVE *********************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;loc_shape[<font color="#ff00ff">0</font>], <font color="#ff00ff">2</font>, MPI_INT,source, tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MPI_COMM_WORLD,&amp;stat); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;loc_x, <font color="#ff00ff">1</font>, MPI_DOUBLE,source, tag,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MPI_COMM_WORLD,&amp;stat); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">**************** END OF MPI RECEIVE ************************</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shift = round( (loc_x - base_bbox[<font color="#ff00ff">0</font>] ) / dx );<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(ltrace ) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;</font><font color="#6a5acd">\n</font><font color="#ff00ff">====================</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;from CPU: </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,source);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;shift = </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,shift);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;loc_shape = </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;x </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>, loc_shape[<font color="#ff00ff">0</font>], loc_shape[<font color="#ff00ff">1</font>]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;====================</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dest = i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = i + <font color="#ff00ff">200</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = MPI_Send(&amp;f_r[shift],loc_shape[<font color="#ff00ff">0</font>],MPI_DOUBLE,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <font color="#0000ff">//End of distributiong from rank=0 to all Procs</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <font color="#0000ff">//End of rank=0 job</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = my_rank + <font color="#ff00ff">200</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = MPI_Recv(&amp;f[<font color="#ff00ff">0</font>],shape[<font color="#ff00ff">0</font>],MPI_DOUBLE,source,tag,MPI_COMM_WORLD,&amp;stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">//Making the dummy copy:</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>if</b></font>&nbsp;(make_dummy_copy == <font color="#ff00ff">1</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#a52a2a"><b>for</b></font>&nbsp;(k=shape[<font color="#ff00ff">0</font>];k&lt;shape[<font color="#ff00ff">0</font>]*shape[<font color="#ff00ff">1</font>];k++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f[k] = f[k % shape[<font color="#ff00ff">0</font>]];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>return</b></font>;<br>
}<br>
</font>
		      <div style="clear: both;"></div>
	         </div>
		      <hr />
	         <div class ="date">last update:   , </div>
	    <div class="footer">
           <p><a href="Home.html">Home</a>|<a href="Research.html">Research</a>|<a href="Contact.html">Contact</a>|<a href="Links.html">Links</a>|<a href="Misc.html">Misc</a>|<a href="sg">Template</a></p>

      </div>  
	    <div style="clear: both;">&nbsp;</div>
        </div> <!-- end content -->
	<!-- in class postandside -->

                 <!--in class postandside-->   
         <!--this line is for compatibility issues --><div style="clear: both;">&#160;</div> <!--Displacement --> 
     </div> <!--End of post and side -->

     <!-- in class page2 -->
     <div style="clear: both;">&nbsp;</div>
  </div> <!--End of Page2 -->
     <div style="clear: both;">&nbsp;</div>

</div> <!-- End of page -->
<!--this is end of the file -->
<!-- ~~~ This content is generated using sg web template ~~-->
<!-- ~~~ For more information visit: http://laplace.physics.ubc.ca/People/arman/sg ~~ -->
</body>
</html>
