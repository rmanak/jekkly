<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="Arman Akbarian's Homepage" />
<meta name="keywords" content="Arman Akbarian homepage web webpage academic website site UBC
numerical relativity group" />
<meta name="author" content="Arman Akbarian" />
<link rel="stylesheet" type="text/css" href="pagestyle.css" />
<title>Arman Akbarian's Homepage</title>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>
<div class="page">
  <div class="page2">
     <div style="width:100%;height:1px;font-family: Tahoma; font-size: 1pt;"></div>
     <div  class ="header">
		
	     <div class="title">

			Arman Akbarian
			<div class="subtitle">UNIVERSITY OF BRITISH COLUMBIA <br /> PHYSICS &amp; ASTRONOMY DEPT. </div>
	</div> <!-- End of title -->
		<div class="sidebar">
         	<div class="sider">
               <p><a href="Home.html">Home <img src="img/home.svg" width="11px" /></a>
<a href="Research.html">Research <img src="img/beaker.svg" width="11px" /></a>
<a href="Publications.html">Publications <img src="img/pencil.svg" width="11px" /></a>
<a target="_blank" href="http://laplace.phas.ubc.ca/">Group Page <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/people.svg" width="11px" /></a>
<a href="Contact.html">Contact <img src="img/envelope-closed.svg" width="11px" /></a>
<a href="CV.html">CV <img src="img/person.svg" width="11px" /></a></p>

<hr />

<p><a href="Links.html">Links <img src="img/link.svg" width="11px" /></a>
<a href="Learn-By-Examples.html">Programming <img src="img/code.svg" width="11px"/></a>
<a target="_blank" href="FD_doc">FD Toolkit <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/graph.svg" width="11px" /></a>
<a target="_blank" href="sg">Web Template <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/globe.svg" width="11px" /></a>
<a href="http://rmanak.github.io/notes">Miscellany <img src="img/layers.svg" width="11px" /></a></p>

             </div>
         </div> <!--End of Sidebar -->


     </div> <!-- end header -->
	
     <!--This line is for future use -->   <div style="text-align:center; padding-top:10px; padding-bottom:10px;"></div>
	      
     <!--This line is for compatibility issues --> <div style="width:100%;height:5px;font-family: Tahoma; font-size: 1pt;"></div>
     <!--in class page2 -->
     <div class="postandside">
		        <div class="content">
            <div class="post">
              <p><style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #000000;}
* { font-size: 1em; }
.Comment { color: #8080ff; font-weight: bold; }
.Constant { color: #ff6060; }
.Statement { color: #888800; }
.Type { color: #00ff00; }
-->
</style>

<script type='text/javascript'>
<!--

-->
</script>
<pre id='vimCodeElement'>
<span class="Comment">/*</span><span class="Comment"> Collects all T datas from all CPUS to T_s on rank 0 </span><span class="Comment">*/</span>

<span class="Type">void</span> Collect(<span class="Type">double</span> *T, <span class="Type">double</span> *T_s) {
  <span class="Type">int</span> MAX_MPI_SEND_COUNT = <span class="Constant">15000</span>;
  <span class="Type">int</span> rc;
  <span class="Type">int</span> source, dest,tag;
  MPI_Status stat;
  <span class="Type">int</span> loc_shape[<span class="Constant">2</span>];
  <span class="Type">double</span> loc_x,loc_z;
  <span class="Type">int</span> i,j,shift_x,shift_z;
  <span class="Type">int</span> loc_phys_bdy[<span class="Constant">4</span>];
  <span class="Type">int</span> left_s,right_s,top_s,bottom_s;
  <span class="Type">int</span> k,kk,ll;
  <span class="Type">int</span> indx,indx_s,ii,jj;
  <span class="Type">int</span> cpi;
  source = my_rank;
  dest = <span class="Constant">0</span>;
  tag = my_rank + <span class="Constant">100</span>;
  <span class="Comment">/*</span><span class="Comment">*************MPI SEND ************</span><span class="Comment">*/</span>
  rc = MPI_Send(&amp;shape[<span class="Constant">0</span>],<span class="Constant">2</span>,MPI_INT,dest,tag,MPI_COMM_WORLD);
  rc = MPI_Send(&amp;x[<span class="Constant">0</span>],<span class="Constant">1</span>,MPI_DOUBLE,dest,tag,MPI_COMM_WORLD);
  rc = MPI_Send(&amp;z[<span class="Constant">0</span>],<span class="Constant">1</span>,MPI_DOUBLE,dest,tag,MPI_COMM_WORLD);
  kk = shape[<span class="Constant">0</span>]*shape[<span class="Constant">1</span>]/MAX_MPI_SEND_COUNT;
  <span class="Statement">for</span>(k=<span class="Constant">0</span>;k&lt;kk;k++){
    rc = MPI_Send(&amp;T[k*MAX_MPI_SEND_COUNT],MAX_MPI_SEND_COUNT,MPI_DOUBLE,dest,tag,MPI_COMM_WORLD);
    tag++;
  }
  ll = shape[<span class="Constant">0</span>]*shape[<span class="Constant">1</span>] % MAX_MPI_SEND_COUNT;
  rc = MPI_Send(&amp;T[kk*MAX_MPI_SEND_COUNT],ll,MPI_DOUBLE,dest,tag,MPI_COMM_WORLD);


  rc = MPI_Send(&amp;phys_bdy[<span class="Constant">0</span>],<span class="Constant">4</span>,MPI_INT,dest,tag,MPI_COMM_WORLD);
  <span class="Comment">/*</span><span class="Comment">*************END OF MPI SEND ************</span><span class="Comment">*/</span>
  <span class="Statement">if</span> (my_rank == <span class="Constant">0</span>) {
      setzero(T_s,size_s);
      <span class="Statement">for</span>(cpi=<span class="Constant">0</span>;cpi&lt;numprocs;cpi++) {
        source = cpi;
        tag = cpi+<span class="Constant">100</span>;
        <span class="Comment">/*</span><span class="Comment">*********** MPI RECEIVE *********************</span><span class="Comment">*/</span>
         rc = MPI_Recv(&amp;loc_shape[<span class="Constant">0</span>], <span class="Constant">2</span>, MPI_INT,source, tag,
                  MPI_COMM_WORLD,&amp;stat);
         rc = MPI_Recv(&amp;loc_x, <span class="Constant">1</span>, MPI_DOUBLE,source, tag,
                    MPI_COMM_WORLD,&amp;stat);
         rc = MPI_Recv(&amp;loc_z, <span class="Constant">1</span>, MPI_DOUBLE,source, tag,
                    MPI_COMM_WORLD,&amp;stat);
         kk = loc_shape[<span class="Constant">0</span>]*loc_shape[<span class="Constant">1</span>]/MAX_MPI_SEND_COUNT;
         <span class="Statement">for</span>(k=<span class="Constant">0</span>;k&lt;kk;k++){
           rc = MPI_Recv(&amp;loc_T[k*MAX_MPI_SEND_COUNT],MAX_MPI_SEND_COUNT,
                  MPI_DOUBLE,source,tag, MPI_COMM_WORLD,&amp;stat);
           tag++;
         }
         ll = loc_shape[<span class="Constant">0</span>]*loc_shape[<span class="Constant">1</span>] % MAX_MPI_SEND_COUNT;
         rc = MPI_Recv(&amp;loc_T[kk*MAX_MPI_SEND_COUNT],MAX_MPI_SEND_COUNT,
                  MPI_DOUBLE,source,tag, MPI_COMM_WORLD,&amp;stat);

         rc = MPI_Recv(&amp;loc_phys_bdy[<span class="Constant">0</span>],<span class="Constant">4</span>,MPI_INT,source,tag,
                MPI_COMM_WORLD,&amp;stat);
        <span class="Comment">/*</span><span class="Comment">*********** END OF MPI RECEIVE *********************</span><span class="Comment">*/</span>
        shift_x = (<span class="Type">int</span>)round( (loc_x - base_bbox[<span class="Constant">0</span>] ) / hx );
        shift_z = (<span class="Type">int</span>)round( (loc_z - base_bbox[<span class="Constant">2</span>] ) / hz );

        <span class="Comment">/*</span><span class="Comment">Injecting to _s structure </span><span class="Comment">*/</span>
        <span class="Statement">for</span>(j=<span class="Constant">0</span>;j&lt;loc_shape[<span class="Constant">1</span>];j++) {
          jj = j+shift_z;
          <span class="Statement">for</span>(i=<span class="Constant">0</span>;i&lt;loc_shape[<span class="Constant">0</span>];i++) {
             ii = i+shift_x;
             indx = i+j*loc_shape[<span class="Constant">0</span>];
             indx_s = ii+jj*Nx_s;
             T_s[indx_s] = loc_T[indx];
           }
         }



      } <span class="Comment">//End of for loop over all CPUS</span>
  } <span class="Comment">//END of rank 0 tasks</span>
}

</pre>




</p>

		      <div style="clear: both;"></div>
	         </div>
		      <hr />
	         <div class ="date">last update: Wed Aug 19, 2015</div>
	    <div class="footer">
           <p><a href="Home.html">Home</a>|<a href="Research.html">Research</a>|<a href="Contact.html">Contact</a>|<a href="Links.html">Links</a>|<a href="Misc.html">Misc</a>|<a href="sg">Template</a></p>

      </div>  
	    <div style="clear: both;">&nbsp;</div>
        </div> <!-- end content -->
	<!-- in class postandside -->

                 <!--in class postandside-->   
         <!--this line is for compatibility issues --><div style="clear: both;">&#160;</div> <!--Displacement --> 
     </div> <!--End of post and side -->

     <!-- in class page2 -->
     <div style="clear: both;">&nbsp;</div>
  </div> <!--End of Page2 -->
     <div style="clear: both;">&nbsp;</div>

</div> <!-- End of page -->
<!--this is end of the file -->
<!-- ~~~ This content is generated using sg web template ~~-->
<!-- ~~~ For more information visit: http://laplace.physics.ubc.ca/People/arman/sg ~~ -->
</body>
</html>
