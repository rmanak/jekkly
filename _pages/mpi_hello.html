<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="description" />
<meta name="keywords" content="keywords" />
<meta name="author" content="author" />
<link rel="stylesheet" type="text/css" href="pagestyle.css" />
<title>Arman Akbarian's Homepage</title>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>
<div class="page">
  <div class="page2">
     <div style="width:100%;height:1px;font-family: Tahoma; font-size: 1pt;"></div>
     <div  class ="header">
		
	     <div class="title">

			Arman Akbarian
			<div class="subtitle">UNIVERSITY OF BRITISH COLUMBIA <br /> PHYSICS &amp; ASTRONOMY DEPT. </div>
	</div> <!-- End of title -->
		<div class="sidebar">
         	<div class="sider">
               <p><a href="Home.html">Home <img src="img/home.svg" width="11px" /></a>
<a href="Research.html">Research <img src="img/beaker.svg" width="11px" /></a>
<a href="Publications.html">Publications <img src="img/pencil.svg" width="11px" /></a>
<a target="_blank" href="http://laplace.phas.ubc.ca/">Group Page <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/people.svg" width="11px" /></a>
<a href="Contact.html">Contact <img src="img/envelope-closed.svg" width="11px" /></a>
<a href="CV.html">CV <img src="img/person.svg" width="11px" /></a></p>

<hr />

<p><a href="Links.html">Links <img src="img/link.svg" width="11px" /></a>
<a href="Learn-By-Examples.html">Programming <img src="img/code.svg" width="11px"/></a>
<a target="_blank" href="FD_doc">FD Toolkit <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/graph.svg" width="11px" /></a>
<a target="_blank" href="sg">Web Template <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/globe.svg" width="11px" /></a>
<a href="http://rmanak.github.io/notes">Miscellany <img src="img/layers.svg" width="11px" /></a></p>

             </div>
         </div> <!--End of Sidebar -->


     </div> <!-- end header -->
	
     <!--This line is for future use -->   <div style="text-align:center; padding-top:10px; padding-bottom:10px;"></div>
	      
     <!--This line is for compatibility issues --> <div style="width:100%;height:5px;font-family: Tahoma; font-size: 1pt;"></div>
     <!--in class page2 -->
     <div class="postandside">
		        <div class="content">
            <div class="post">
              <font color="#a020f0">#include </font><font color="#ff00ff">&lt;stdio.h&gt;</font><br>
<font color="#a020f0">#include </font><font color="#ff00ff">&lt;mpi.h&gt;</font><br>
<br>
<br>
<font color="#a020f0">#define SIZE </font><font color="#ff00ff">1000</font><br>
<font color="#2e8b57"><b>int</b></font>&nbsp;main(<font color="#2e8b57"><b>int</b></font>&nbsp;argc, <font color="#2e8b57"><b>char</b></font>&nbsp;*argv[]) {<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;&nbsp;numprocs, <font color="#0000ff">//to store the number of processors used</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rank,&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">//to store the rank of the processor that runs the code</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;namelen;&nbsp;&nbsp;<font color="#0000ff">//to store the length of the name of the processor </font><br>
&nbsp;&nbsp; <font color="#2e8b57"><b>char</b></font>&nbsp;processor_name[MPI_MAX_PROCESSOR_NAME]; <font color="#0000ff">//to store the name of the processor</font><br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;source, dest, tag, count; <font color="#0000ff">//variables used in point-to-point communications</font><br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;rc;&nbsp;&nbsp;<font color="#0000ff">//to store the return code at various points</font><br>
&nbsp;&nbsp; <font color="#2e8b57"><b>char</b></font>&nbsp;inmsg, outmsg;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">//variables used for ptop comm </font><br>
&nbsp;&nbsp; MPI_Status Stat; <font color="#0000ff">//specific type of data to store MPI status</font><br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;ary[SIZE];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;tary[SIZE];<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;offset, chunksize;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;sum,tsum;<br>
&nbsp;&nbsp; <font color="#2e8b57"><b>int</b></font>&nbsp;i;<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Init:</font><br>
<font color="#0000ff">&nbsp;* should be called before any MPI routine, </font><br>
<font color="#0000ff">&nbsp;* just call once, to initialize MPI, </font><br>
<font color="#0000ff">&nbsp;* and can pass the program arguments to all the processors, </font><br>
<font color="#0000ff">&nbsp;* example of argument: '-np 4' (to run the program on 4 processors)</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; MPI_Init(&amp;argc, &amp;argv);<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_COMM_WORLD:</font><br>
<font color="#0000ff">&nbsp;* is the handle used to communicate between the processors</font><br>
<font color="#0000ff">&nbsp;* it is usually required for any commnunicator routines, see below: </font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Comm_size:</font><br>
<font color="#0000ff">&nbsp;* determines the number of processors in the &quot;MPI_COMM_WORLD&quot;</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; MPI_Comm_size(MPI_COMM_WORLD, &amp;numprocs);<br>
<br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(numprocs &lt; <font color="#ff00ff">2</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Quitting...Number of MPI tasks must be bigger than 1.</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_Abort(MPI_COMM_WORLD,rc); <font color="#0000ff">//to abort</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(<font color="#ff00ff">0</font>);<br>
&nbsp;&nbsp; }<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Comm_rank:</font><br>
<font color="#0000ff">&nbsp;* determines the rank of the processor in the MPI_COMM_WORLD</font><br>
<font color="#0000ff">&nbsp;* each CPU has a &quot;rank&quot;, an integer number starting from 0</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(rank == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Hello World! (from the master task)</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>); <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Total number of processors: </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,numprocs); <br>
&nbsp;&nbsp; }<br>
&nbsp;&nbsp; <br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Get_processor_name:</font><br>
<font color="#0000ff">&nbsp;* determines the name of the processor, the name must be</font><br>
<font color="#0000ff">&nbsp;* at least at length of MPI_MAX_PROCESSOR_NAME (it is 256)</font><br>
<font color="#0000ff">&nbsp;* second argument is the length of the returning processor_name</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_Get_processor_name(processor_name, &amp;namelen);<br>
&nbsp;&nbsp; <br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(rank !=<font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp; printf(<font color="#ff00ff">&quot;Process </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;on </font><font color="#6a5acd">%s</font><font color="#ff00ff">&nbsp;says Hello World!</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>, rank, processor_name);<br>
&nbsp;&nbsp; }<br>
<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Send:</font><br>
<font color="#0000ff">&nbsp;* is to send point-to-point data (between two processors)</font><br>
<font color="#0000ff">&nbsp;* Format:</font><br>
<font color="#0000ff">&nbsp;* MPI_send(</font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;data (buffer for data to be sent)</font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int count (count of data) </font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_variable type (predefined MPI types, example: MPI_INT,MPI_DOUBLE,MPI_CHAR ...) </font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int dest (task id)</font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int tag (unique id for msg) </font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_COMM_WORLD (the group of communications, usually just MPI_COMM_WORLD)</font><br>
<font color="#0000ff">&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) </font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(rank == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dest = <font color="#ff00ff">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outmsg = <font color="#ff00ff">'X'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count = <font color="#ff00ff">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = <font color="#ff00ff">100</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Sending Msg X from Proc 0 to 1...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Send(&amp;outmsg, count, MPI_CHAR, dest, tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;rc is the return code, to capture the possible errors</font><br>
<font color="#0000ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * however MPI library is written such that the routine quits </font><br>
<font color="#0000ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * if some error occurs, so probably won't be able to capture the rc</font><br>
<font color="#0000ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Msg: </font><font color="#6a5acd">%c</font><font color="#ff00ff">&nbsp;is sent to processor </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,outmsg,dest);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outmsg = <font color="#ff00ff">'Y'</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = <font color="#ff00ff">101</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Sending Msg Y from Proc 0 to 1 with Sync Send...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Ssend:</font><br>
<font color="#0000ff">&nbsp;* is similar to MPI_Send, while the send routine waits till the msg is received</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rc = MPI_Ssend(&amp;outmsg, count,MPI_CHAR,dest,tag,MPI_COMM_WORLD);<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;next command will be invoked after 5 second: see the recieving part </font><font color="#0000ff">*/</font>&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Msg: </font><font color="#6a5acd">%c</font><font color="#ff00ff">&nbsp;is sent to processor </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,outmsg,dest);<br>
&nbsp;&nbsp; }&nbsp;&nbsp;<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_Recv:</font><br>
<font color="#0000ff">&nbsp;* similar to MPI_Send, for receiving the ptop data</font><br>
<font color="#0000ff">&nbsp;* format is pretty clear from the example</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; <font color="#a52a2a"><b>else</b></font>&nbsp;<font color="#a52a2a"><b>if</b></font>&nbsp;(rank == <font color="#ff00ff">1</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp; source = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp; count = <font color="#ff00ff">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp; tag = <font color="#ff00ff">100</font>; <font color="#0000ff">//note that if you use different tag, task 1 will not recieve the msg</font><br>
&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;inmsg, count, MPI_CHAR, source, tag, MPI_COMM_WORLD, &amp;Stat);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; printf(<font color="#ff00ff">&quot;Msg: </font><font color="#6a5acd">%c</font><font color="#ff00ff">&nbsp;is recieved from processor </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,inmsg, source);<br>
&nbsp;&nbsp;&nbsp;&nbsp; sleep(<font color="#ff00ff">2</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp; tag = <font color="#ff00ff">101</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp; rc = MPI_Recv(&amp;inmsg, count, MPI_CHAR, source, tag, MPI_COMM_WORLD, &amp;Stat);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp; printf(<font color="#ff00ff">&quot;Msg: </font><font color="#6a5acd">%c</font><font color="#ff00ff">&nbsp;is received from processor </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,inmsg,source);<br>
&nbsp;&nbsp; }<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Example of Dividing an array into smaller portions and </font><br>
<font color="#0000ff">&nbsp;* adding them in each processor and sending the result to </font><br>
<font color="#0000ff">&nbsp;* the master task:</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
<br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(SIZE % numprocs != <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(<font color="#ff00ff">&quot;Quitting. </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;/ </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;is not zero</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,SIZE,numprocs);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MPI_Abort(MPI_COMM_WORLD,rc);<br>
&nbsp;&nbsp; } <font color="#a52a2a"><b>else</b></font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chunksize = SIZE / numprocs;<br>
&nbsp;&nbsp; }<br>
<br>
&nbsp;&nbsp; <font color="#a52a2a"><b>if</b></font>&nbsp;(rank == <font color="#ff00ff">0</font>) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Initializing the array </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;( i = <font color="#ff00ff">0</font>; i&lt;SIZE; i++) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ary[i] = i+<font color="#ff00ff">1</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Array initialized...</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Sending the portions of the array to each processor </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;chunksize = </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,chunksize);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;(i=<font color="#ff00ff">1</font>; i&lt;numprocs; i++){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tag = i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dest=i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; offset = i*chunksize;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Sending the offset so each proc first receives the pointer </font><br>
<font color="#0000ff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* to the actual data </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MPI_Send(&amp;offset,<font color="#ff00ff">1</font>,MPI_INT,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MPI_Send(&amp;ary[offset],chunksize,MPI_INT,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(<font color="#ff00ff">&quot;Data starting at </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;is sent to proc </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ,ary[offset],dest);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;The first chunk of array is summed by the master task </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;(i=<font color="#ff00ff">0</font>; i&lt;chunksize; i++){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+= ary[i];<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Receiving the sum from each processors </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;(i=<font color="#ff00ff">1</font>; i&lt;numprocs; i++){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; source = i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tag = i;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MPI_Recv(&amp;tsum,<font color="#ff00ff">1</font>,MPI_INT,source,tag,MPI_COMM_WORLD,&amp;Stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf(<font color="#ff00ff">&quot;Sum </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;is received from proc </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,tsum,source);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum+=tsum;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;And printing the final result </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Total sum is: </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,sum);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">End of main task</font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp; } <font color="#a52a2a"><b>else</b></font>&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;source = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tag = rank;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Receiving the data from master tast </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_Recv(&amp;offset,<font color="#ff00ff">1</font>,MPI_INT,source,tag,MPI_COMM_WORLD,&amp;Stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_Recv(&amp;tary[offset],chunksize,MPI_INT,source,tag,MPI_COMM_WORLD,&amp;Stat);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(<font color="#ff00ff">&quot;Data starting at </font><font color="#6a5acd">%d</font><font color="#ff00ff">&nbsp;is received to proc </font><font color="#6a5acd">%d</font><font color="#6a5acd">\n</font><font color="#ff00ff">&quot;</font>,tary[offset],rank);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Doing the calculation on data </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsum = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#a52a2a"><b>for</b></font>&nbsp;(i=offset; i&lt;chunksize+offset; i++){<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tsum += tary[i]; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dest = <font color="#ff00ff">0</font>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;Sending back the results to main task: </font><font color="#0000ff">*/</font><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MPI_Send(&amp;tsum,<font color="#ff00ff">1</font>,MPI_INT,dest,tag,MPI_COMM_WORLD);<br>
&nbsp;&nbsp; }<br>
<br>
<br>
<font color="#0000ff">/*</font><font color="#0000ff">&nbsp;MPI_finalize:</font><br>
<font color="#0000ff">&nbsp;* to finalize the MPI, no MPI routine may be called after this:</font><br>
<font color="#0000ff">&nbsp;</font><font color="#0000ff">*/</font><br>
<br>
&nbsp;&nbsp; MPI_Finalize();<br>
}<br>
<br>
</font>
		      <div style="clear: both;"></div>
	         </div>
		      <hr />
	         <div class ="date">last update:   , </div>
	    <div class="footer">
           <p><a href="Home.html">Home</a>|<a href="Research.html">Research</a>|<a href="Contact.html">Contact</a>|<a href="Links.html">Links</a>|<a href="Misc.html">Misc</a>|<a href="sg">Template</a></p>

      </div>  
	    <div style="clear: both;">&nbsp;</div>
        </div> <!-- end content -->
	<!-- in class postandside -->

                 <!--in class postandside-->   
         <!--this line is for compatibility issues --><div style="clear: both;">&#160;</div> <!--Displacement --> 
     </div> <!--End of post and side -->

     <!-- in class page2 -->
     <div style="clear: both;">&nbsp;</div>
  </div> <!--End of Page2 -->
     <div style="clear: both;">&nbsp;</div>

</div> <!-- End of page -->
<!--this is end of the file -->
<!-- ~~~ This content is generated using sg web template ~~-->
<!-- ~~~ For more information visit: http://laplace.physics.ubc.ca/People/arman/sg ~~ -->
</body>
</html>
