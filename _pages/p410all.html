<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="description" />
<meta name="keywords" content="keywords" />
<meta name="author" content="author" />
<link rel="stylesheet" type="text/css" href="pagestyle.css" />
<title>Arman Akbarian's Homepage</title>
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body>
<div class="page">
  <div class="page2">
     <div style="width:100%;height:1px;font-family: Tahoma; font-size: 1pt;"></div>
     <div  class ="header">
		
	     <div class="title">

			Arman Akbarian
			<div class="subtitle">UNIVERSITY OF BRITISH COLUMBIA <br /> PHYSICS &amp; ASTRONOMY DEPT. </div>
	</div> <!-- End of title -->
		<div class="sidebar">
         	<div class="sider">
               <p><a href="Home.html">Home <img src="img/home.svg" width="11px" /></a>
<a href="Research.html">Research <img src="img/beaker.svg" width="11px" /></a>
<a href="Publications.html">Publications <img src="img/pencil.svg" width="11px" /></a>
<a target="_blank" href="http://laplace.phas.ubc.ca/">Group Page <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/people.svg" width="11px" /></a>
<a href="Contact.html">Contact <img src="img/envelope-closed.svg" width="11px" /></a>
<a href="CV.html">CV <img src="img/person.svg" width="11px" /></a></p>

<hr />

<p><a href="Links.html">Links <img src="img/link.svg" width="11px" /></a>
<a href="Learn-By-Examples.html">Programming <img src="img/code.svg" width="11px"/></a>
<a target="_blank" href="FD_doc">FD Toolkit <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/graph.svg" width="11px" /></a>
<a target="_blank" href="sg">Web Template <img style="margin-left:1px;" src="img/external-link.svg" alt="" align="bottom" /> <img src="img/globe.svg" width="11px" /></a>
<a href="http://rmanak.github.io/notes">Miscellany <img src="img/layers.svg" width="11px" /></a></p>

             </div>
         </div> <!--End of Sidebar -->


     </div> <!-- end header -->
	
     <!--This line is for future use -->   <div style="text-align:center; padding-top:10px; padding-bottom:10px;"></div>
	      
     <!--This line is for compatibility issues --> <div style="width:100%;height:5px;font-family: Tahoma; font-size: 1pt;"></div>
     <!--in class page2 -->
     <div class="postandside">
		        <div class="content">
            <div class="post">
              <pre style="color:#1f1c1b;">
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     fdemo1:  Program which demonstrates many of the </span>
<span style='color:#898887;'>c     essential features of Fortran 77. Some 'safe' language </span>
<span style='color:#898887;'>c     extensions are used; all extensions are valid </span>
<span style='color:#898887;'>c     Fortran 90.</span>
<span style='color:#898887;'>c===========================================================</span>
 
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Source code formatting rules:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Columns    Use</span>
<span style='color:#898887;'>c </span>
<span style='color:#898887;'>c     1-5        numeric statement label</span>
<span style='color:#898887;'>c     6          continuation character: '&amp;' recommended</span>
<span style='color:#898887;'>c     7-72       statement</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     BE EXTREMELY CAREFUL NOT TO TYPE BEYOND COLUMN 72!</span>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>C     COMMENT LINES: Use 'c' 'C' or '*' IN FIRST COLUMN</span>
<span style='color:#898887;'>*===========================================================</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The 'program' statement names a Fortran main routine.</span>
<span style='color:#898887;'>c     Optional, but recommended and note that there can </span>
<span style='color:#898887;'>c     only be one 'program' (main routine) per executable.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>program</b>         fdemo1

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     BEGINNING OF DECLARATION STATEMENTS</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Declarations (or specification statements) must </span>
<span style='color:#898887;'>c     ALWAYS appear before ANY executable statements.</span>
<span style='color:#898887;'>c===========================================================</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The 'implicit none' statement is an extension which </span>
<span style='color:#898887;'>c     forces us to explicitly declare all variables and </span>
<span style='color:#898887;'>c     functions (apart from Fortran built in functions).</span>
<span style='color:#898887;'>c     HIGHLY RECOMMENDED.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     PARAMETERS</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The parameter declaration effectively assigns a </span>
<span style='color:#898887;'>c     CONSTANT value to a name.  Note that each </span>
<span style='color:#898887;'>c     parameter statement must be accompanied by an </span>
<span style='color:#898887;'>c     appropriate declaration of the type of the </span>
<span style='color:#898887;'>c     parameter.  Also note that, except in strings, </span>
<span style='color:#898887;'>c     blanks (spaces) are ignored in Fortran---you can </span>
<span style='color:#898887;'>c     use this fact to make code more readable.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         zero
      <span style='color:#0057ae;'>parameter</span>     ( zero <b>=</b> <span style='color:#b08000;'>0</span> )

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Always specify floating point constants using </span>
<span style='color:#898887;'>c     scientific notation.  Use 'd' (instead of 'e') for </span>
<span style='color:#898887;'>c     real*8 constants.  </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>          pi
      <span style='color:#0057ae;'>parameter</span>     ( pi   <b>=</b> <span style='color:#b08000;'>3.141</span> <span style='color:#b08000;'>5926</span> <span style='color:#b08000;'>5358</span> <span style='color:#b08000;'>9793</span> d0 )

      <span style='color:#0057ae;'>real*8</span>          <b><i><span style='color:#000060;'>tiny</span></i></b>
      <span style='color:#0057ae;'>parameter</span>     ( <b><i><span style='color:#000060;'>tiny</span></i></b> <b>=</b> <span style='color:#b08000;'>1.0</span> d<b>-</b><span style='color:#b08000;'>50</span> )

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     VARIABLES</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The main data types we will be using are </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     integer,  real*8,  logical,  </span>
<span style='color:#898887;'>c     character*1,  character*2, ... etc., character*(*)</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     but note that Fortran has support for complex </span>
<span style='color:#898887;'>c     arithmetic.  Note that complex*16 means real*8 </span>
<span style='color:#898887;'>c     values are used for both the real and imaginary </span>
<span style='color:#898887;'>c     parts of the variable.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     (a) SCALARS</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>         a,        b,       c    
      <span style='color:#0057ae;'>real*8</span>         res1,     res2,    res3,    res4
      <span style='color:#0057ae;'>integer</span>        i,        j,       k,       n
      <span style='color:#0057ae;'>integer</span>        ires1,    ires2,   ires3,   ires4
      <span style='color:#0057ae;'>logical</span>        switch
      <span style='color:#0057ae;'>logical</span>        lres1,    lres2,   lres3
      <span style='color:#0057ae;'>complex*16</span>     ca,       cb
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     (b) ARRAYS</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>        n1,       n2,      n3
      <span style='color:#0057ae;'>parameter</span>    ( n1 <b>=</b> <span style='color:#b08000;'>4</span>,   n2 <b>=</b> <span style='color:#b08000;'>3</span>,  n3 <b>=</b> <span style='color:#b08000;'>2</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     (b.1) 1-D ARRAYS:  Note, in a main program, all</span>
<span style='color:#898887;'>c     dimension bounds must be integer parameters or </span>
<span style='color:#898887;'>c     integer constants.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>         r1a(n1),   r1b(n2)
      <span style='color:#0057ae;'>integer</span>        i1i(n1)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     (b.2) 2-D ARRAYS:</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>         r2a(n1,n2)         
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     (b.3) 3-D ARRAYS:</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>         r3a(n1,n2,n3)         

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     END OF DECLARATION STATEMENTS</span>
<span style='color:#898887;'>c===========================================================</span>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     BEGINNING OF EXECUTABLE STATEMENTS</span>
<span style='color:#898887;'>c===========================================================</span>

<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     Assignment statements and simple arithmetic </span>
<span style='color:#898887;'>c     expressions </span>
<span style='color:#898887;'>c***********************************************************</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Assignment to scalar variables ... again, note </span>
<span style='color:#898887;'>c     the use of scientific notation (d0) to specify </span>
<span style='color:#898887;'>c     a real*8 constant.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     The only valid logical constants are .true. and </span>
<span style='color:#898887;'>c     .false.  (don't forget to include the .'s)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      a <b>=</b>  <span style='color:#b08000;'>0.025d0</span>
      b <b>=</b> <b>-</b><span style='color:#b08000;'>1.234d-16</span>
      c <b>=</b>  <span style='color:#b08000;'>1.0d0</span> 
      i <b>=</b>  <span style='color:#b08000;'>3000</span>
      switch <b>=</b> <b><span style='color:#800080;'>.true.</span></b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Note the use of the continuation character in </span>
<span style='color:#898887;'>c     column 6 to continue a statement on a second line.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'a = '</span>, a,<span style='color:#bf0303;'>' b = '</span>, b
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>' c = '</span>, c, <span style='color:#bf0303;'>' i = '</span>, i, 
     <b>&amp;</b>           <span style='color:#bf0303;'>' switch = '</span>, switch
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through scalar assignment'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Arithmetic expressions.  Fortran has standard </span>
<span style='color:#898887;'>c     operator precedences except that the exponentiation</span>
<span style='color:#898887;'>c     operator '**' associates RIGHT to LEFT:  e.g.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     i ** j ** k  is equivalent to  i ** (j ** k)</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Parentheses force evaluation of subexpressions.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      a <b>=</b> <span style='color:#b08000;'>2.0d0</span>
      b <b>=</b> <span style='color:#b08000;'>3.0d0</span>
      c <b>=</b> <span style='color:#b08000;'>3.0d0</span>

      res1  <b>=</b> a <b>+</b> b
      res2  <b>=</b> a<b>**</b><span style='color:#b08000;'>2</span> <b>+</b> b<b>**</b><span style='color:#b08000;'>2</span> 
      res3  <b>=</b> (a<b>**</b><span style='color:#b08000;'>2</span> <b>+</b> b<b>**</b><span style='color:#b08000;'>2</span>)<b>**</b>(<span style='color:#b08000;'>0.5d0</span>) 
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'res1 = '</span>, res1,<span style='color:#bf0303;'>' res2 = '</span>, res2
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>' res3 = '</span>, res3
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through real*8 arithmetic expressions'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Notice the integer truncation which occurs when </span>
<span style='color:#898887;'>c     dividing the integer 2 by the integer 3.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      i <b>=</b> <span style='color:#b08000;'>2</span>
      j <b>=</b> <span style='color:#b08000;'>3</span>
      k <b>=</b> <span style='color:#b08000;'>2</span>

      ires1 <b>=</b> <span style='color:#b08000;'>2</span> <b>+</b> <span style='color:#b08000;'>3</span>
      ires2 <b>=</b> <span style='color:#b08000;'>2</span> <b>/</b> <span style='color:#b08000;'>3</span>
      ires3 <b>=</b> i <b>**</b> j <b>**</b> k
      ires4 <b>=</b> (i <b>**</b> j) <b>**</b> k
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'ires1 = '</span>, ires1, <span style='color:#bf0303;'>' ires2 = '</span>, ires2
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'ires3 = '</span>, ires3, <span style='color:#bf0303;'>' ires4 = '</span>, ires4
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through integer arithmetic expressions'</span>)
      
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     &quot;Mixed-mode&quot; computations </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     i + j  is  computed using integer arithmetic and </span>
<span style='color:#898887;'>c     the result is converted to a real*8 value before being </span>
<span style='color:#898887;'>c     assigned to res2.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      res1 <b>=</b> i <b>+</b> j

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     3 / 4 is evaluated using integer arithmetic (yielding</span>
<span style='color:#898887;'>c     0) and then the value is converted to real*8.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      res2 <b>=</b> <span style='color:#b08000;'>3</span> <b>/</b> <span style='color:#b08000;'>4</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The appearance of a double precision constant </span>
<span style='color:#898887;'>c     forces the division to be computed using real*8 </span>
<span style='color:#898887;'>c     arithmetic</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      res3 <b>=</b> <span style='color:#b08000;'>3</span> <b>/</b> <span style='color:#b08000;'>4.0d0</span> 
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'res1 = '</span>, res1, <span style='color:#bf0303;'>' res2 = '</span>, res2
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>' res3 = '</span>, res3
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through mixed-mode arithmetic'</span>)

<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     CONTROL STATEMENTS</span>
<span style='color:#898887;'>c***********************************************************</span>

<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     DO LOOPS </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Note that 'end do' is not Fortran 77, but a safe</span>
<span style='color:#898887;'>c     extension (it is legal Fortran 90).</span>
<span style='color:#898887;'>c***********************************************************</span>

      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>3</span>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Loop 1: i = '</span>, i
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through loop 1'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The same do loop with the optional loop increment</span>
<span style='color:#898887;'>c     specified explicitly </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>3</span> , <span style='color:#b08000;'>1</span>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Loop 2: i = '</span>, i
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through loop 2'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Another do-loop with a non-default loop increment ...</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>7</span> , <span style='color:#b08000;'>2</span>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Loop 3: i = '</span>, i
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through loop 3'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     ... and one with a negative increment</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>3</span> , <span style='color:#b08000;'>1</span> , <b>-</b><span style='color:#b08000;'>1</span>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Loop 4: i = '</span>, i
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through loop 4'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Nested do-loops.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>3</span>
         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>2</span>
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Loop 5: i, j = '</span>, i, j
         <b>end do</b>
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through loop 5'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Any of the do-loop parameters can be variables,</span>
<span style='color:#898887;'>c     expressions or parameters: safest to ALWAYS use</span>
<span style='color:#898887;'>c     integer values.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      n <b>=</b> <span style='color:#b08000;'>6</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>2</span> , n , n <b>/</b> <span style='color:#b08000;'>3</span>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Loop 6: i = '</span>, i
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through loop 6'</span>)


<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     LOGICAL EXPRESSIONS </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Note that the Fortran comparison and logical</span>
<span style='color:#898887;'>c     operators all have the form: .operator. </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Comparison:   .eq.    .ne.    .gt.    .lt.  </span>
<span style='color:#898887;'>c                   .ge.    .le. </span>
<span style='color:#898887;'>c     Logical:      .not. (unary)</span>
<span style='color:#898887;'>c                   .and.   .or.</span>
<span style='color:#898887;'>c***********************************************************</span>

      a <b>=</b> <span style='color:#b08000;'>25.0d0</span>
      b <b>=</b> <span style='color:#b08000;'>12.0d0</span>

      lres1 <b>=</b> a <b><span style='color:#008000;'>.gt.</span></b> b
      lres2 <b>=</b> (a <b><span style='color:#008000;'>.lt.</span></b> b)  <b><span style='color:#008000;'>.or.</span></b>  (b <b><span style='color:#008000;'>.ge.</span></b> <span style='color:#b08000;'>0.0d0</span>)
      lres3 <b>=</b> a <b><span style='color:#008000;'>.eq.</span></b> b
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'lres1 = '</span>, lres1, <span style='color:#bf0303;'>' lres2 = '</span>, lres2,
     <b>&amp;</b>           <span style='color:#bf0303;'>' lres3 = '</span>, lres3
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through basic conditionals'</span>)

<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     IF-THEN-ELSE STATEMENTS.</span>
<span style='color:#898887;'>c***********************************************************</span>

      <b>if</b>( a <b><span style='color:#008000;'>.gt.</span></b> b ) <b>then</b>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> a, <span style='color:#bf0303;'>' &gt; '</span>, b
      <b>end if</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through if 1'</span>)

      <b>if</b>( b <b><span style='color:#008000;'>.gt.</span></b> a ) <b>then</b>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> b, <span style='color:#bf0303;'>' &gt; '</span>, a
      <b>else</b>
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> a, <span style='color:#bf0303;'>' &gt; '</span>, b
      <b>end if</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through if 2'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Nested IF statement.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>if</b>( a <b><span style='color:#008000;'>.gt.</span></b> b ) <b>then</b>
         <b>if</b>( a <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>2</span> <b>*</b> b ) <b>then</b>
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> a, <span style='color:#bf0303;'>' &gt; '</span>, <span style='color:#b08000;'>2</span> <b>*</b> b
         <b>else</b> 
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> a, <span style='color:#bf0303;'>' &lt;= '</span>, <span style='color:#b08000;'>2</span> <b>*</b> b
         <b>end if</b>
      <b>else</b> 
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> a, <span style='color:#bf0303;'>' &lt;= '</span>, b
      <b>end if</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through nested if'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     IF ... ELSE IF .. IF construct can be used in lieu</span>
<span style='color:#898887;'>c     of 'CASE' statement.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>4</span>
         <b>if</b>(      i <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>1</span> ) <b>then</b>
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Case 1'</span>
         <b>else if</b>( i <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>2</span> ) <b>then</b>
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Case 2'</span>
         <b>else if</b>( i <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>3</span> ) <b>then</b>
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Case 3'</span>
         <b>else</b> 
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Default case'</span>
         <b>end if</b>
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through case via if'</span>)

<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     WHILE LOOPS </span>
<span style='color:#898887;'>c </span>
<span style='color:#898887;'>c     The do while( ... ) ... end do construct is valid </span>
<span style='color:#898887;'>c     Fortran 90, and a safe Fortran 77 extension.</span>
<span style='color:#898887;'>c***********************************************************</span>
      a <b>=</b> <span style='color:#b08000;'>0.1d0</span>
      b <b>=</b> <span style='color:#b08000;'>0.0d0</span> 
      <b>do</b> <b>while</b> ( b <b><span style='color:#008000;'>.le.</span></b> <span style='color:#b08000;'>1.0d0</span> ) 
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Do while loop: b = '</span>, b
         b <b>=</b> b <b>+</b> a
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through while loop'</span>)

<span style='color:#898887;'>c***********************************************************</span>
<span style='color:#898887;'>c     USING BUILT-IN (INTRINSIC) FUNCTIONS</span>
<span style='color:#898887;'>c***********************************************************</span>
      res1 <b>=</b> <b><span style='color:#600060;'>sin</span></b>(<span style='color:#b08000;'>0.3d0</span> <b>*</b> Pi)
      res2 <b>=</b> <b><span style='color:#600060;'>cos</span></b>(<span style='color:#b08000;'>0.3d0</span> <b>*</b> Pi)
      res3 <b>=</b> res1<b>**</b><span style='color:#b08000;'>2</span> <b>+</b> res2<b>**</b><span style='color:#b08000;'>2</span>
      res4 <b>=</b> <b><span style='color:#600060;'>sqrt</span></b>(res3)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'res1 = '</span>, res1, <span style='color:#bf0303;'>' res2 = '</span>, res2
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'res3 = '</span>, res3, <span style='color:#bf0303;'>' res4 = '</span>, res4
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through built-in fcn 1'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     atan, acos, asin, etc. return arctangent, arcosine, </span>
<span style='color:#898887;'>c     arcsine etc. in RADIANS</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      res1 <b>=</b> <b><span style='color:#600060;'>atan</span></b>(<span style='color:#b08000;'>1.0d0</span>)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'res1 = '</span>, res1
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through built-in fcn 2'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     min and max will return the minimum and maximum </span>
<span style='color:#898887;'>c     respectively of an arbitrary number of arguments </span>
<span style='color:#898887;'>c     of any UNIQUE data type.  Do NOT mix types in </span>
<span style='color:#898887;'>c     a single statement as in </span>
<span style='color:#898887;'>c  </span>
<span style='color:#898887;'>c     write(*,*) min(1,2.0d0)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'min(3.0d0,2.0d0) = '</span>, <b><span style='color:#600060;'>min</span></b>(<span style='color:#b08000;'>3.0d0</span>,<span style='color:#b08000;'>2.0d0</span>)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'min(1,-3,5,0) = '</span>, <b><span style='color:#600060;'>min</span></b>(<span style='color:#b08000;'>1</span>,<b>-</b><span style='color:#b08000;'>3</span>,<span style='color:#b08000;'>5</span>,<span style='color:#b08000;'>0</span>)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through built-in fcn 3'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     mod is particularly useful for calculating when one </span>
<span style='color:#898887;'>c     integer divides another evenly</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>0</span> , <span style='color:#b08000;'>1000</span> 
         <b>if</b>( <b><span style='color:#600060;'>mod</span></b>(i,<span style='color:#b08000;'>100</span>) <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'i = '</span>, i
         <b>end if</b>
      <b>end do</b>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through built-in fcn 4'</span>)
 
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Stop program execution</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through fdemo1'</span>)
      <b>stop</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     END OF EXECUTABLE STATEMENTS</span>
<span style='color:#898887;'>c===========================================================</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     End of program unit (fdemo1)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Prints a message on stdout and then waits for input </span>
<span style='color:#898887;'>c     from stdin.</span>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     A new program unit (prompt).</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>subroutine</b> prompt(pstring)

         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>) pstring
         <span style='color:#0057ae;'>integer</span>       rc
         <span style='color:#0057ae;'>character*1</span>   resp

         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> pstring
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Enter any non-blank character &amp; '</span><b>//</b>
     <b>&amp;</b>              <span style='color:#bf0303;'>'enter to continue'</span>

         <span style='color:#006060;'>read(*</span>,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>end</span><b>=</b><span style='color:#b08000;'>900</span><span style='color:#006060;'>)</span>  resp
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Return to calling program.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>return</b>
 
 <span style='color:#b08000;'>900</span>     <b>continue</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Stop program execution.  This section of code is </span>
<span style='color:#898887;'>c        the &quot;end-of-file&quot; handler for standard input</span>
<span style='color:#898887;'>c        (via the end=900 clause of the read statement).</span>
<span style='color:#898887;'>c        In this case, it is perfectly good style simply </span>
<span style='color:#898887;'>c        to quit. </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>stop</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     End of program unit (prompt).</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>end</b> 
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     fdemo2:  Program which demonstrates basic usage </span>
<span style='color:#898887;'>c     of character variables in Fortran 77.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         fdemo2

      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     See below for definition of integer function</span>
<span style='color:#898887;'>c     'indlnb'.   Note that this and other useful routines</span>
<span style='color:#898887;'>c     are available in the 'p410f' library.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         indlnb

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Define some character variables of various lengths</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Note that </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        character*1     foo</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     and </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        character       foo</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     are synonymous, i.e. if an explicit length </span>
<span style='color:#898887;'>c     specification is not given, the variable will</span>
<span style='color:#898887;'>c     be a single character long.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>character*1</span>     c1
      <span style='color:#0057ae;'>character*2</span>     c2
      <span style='color:#0057ae;'>character*4</span>     c4
      <span style='color:#0057ae;'>character*26</span>    lcalph
      <span style='color:#0057ae;'>character</span>       cc1<b>*</b><span style='color:#b08000;'>1</span>,    cc2<b>*</b><span style='color:#b08000;'>2</span>,   cc4<b>*</b><span style='color:#b08000;'>4</span>
      <span style='color:#0057ae;'>character*60</span>    buffer

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Assignment of constant strings to char. variables.</span>
<span style='color:#898887;'>c     If length of character expression being assigned </span>
<span style='color:#898887;'>c     is less than length of character variable, variable </span>
<span style='color:#898887;'>c     is 'right-padded' with blanks.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      c1     <b>=</b> <span style='color:#bf0303;'>'a'</span>
      c2     <b>=</b> <span style='color:#bf0303;'>'bc'</span>
      c4     <b>=</b> <span style='color:#bf0303;'>'defg'</span>
      lcalph <b>=</b> <span style='color:#bf0303;'>'abcdefghijklmnopqrstuvwxyz'</span>
 
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'c1 = '</span>, c1
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'c2 = '</span>, c2
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'c4 = '</span>, c4
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'lcalph = '</span>, lcalph
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through constant assignment'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     // is the string concatentation operator </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'c1 // c2 // c4 = '</span>, c1 <b>//</b> c2 <b>//</b> c4
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through concatenation'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The integer intrinsic (built-in) function 'len'</span>
<span style='color:#898887;'>c     returns the length of its string argument</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'len(c1) = '</span>, <b><i><span style='color:#000060;'>len</span></i></b>(c1)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'len(buffer) = '</span>, <b><i><span style='color:#000060;'>len</span></i></b>(buffer)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through string length'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Substring extraction</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'lcalph(1:13) = '</span>,  lcalph(<span style='color:#b08000;'>1</span>:<span style='color:#b08000;'>13</span>)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'lcalph(18:18) = '</span>, lcalph(<span style='color:#b08000;'>18</span>:<span style='color:#b08000;'>18</span>)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through substring extraction'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Substring assignment</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      c4(<span style='color:#b08000;'>4</span>:<span style='color:#b08000;'>4</span>) <b>=</b> <span style='color:#bf0303;'>'Z'</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'c4 = '</span>, c4
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through substring assignment'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Use of 'indlnb' </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      buffer <b>=</b> <span style='color:#bf0303;'>'somefilename'</span> 
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'&lt;'</span> <b>//</b> buffer <b>//</b> <span style='color:#bf0303;'>'&gt;'</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'&lt;'</span> <b>//</b> buffer(<span style='color:#b08000;'>1</span>:indlnb(buffer)) <b>//</b> <span style='color:#bf0303;'>'&gt;'</span>
      buffer <b>=</b> <span style='color:#bf0303;'>'Some multi-word message'</span> 
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'&lt;'</span> <b>//</b> buffer <b>//</b> <span style='color:#bf0303;'>'&gt;'</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'&lt;'</span> <b>//</b> buffer(<span style='color:#b08000;'>1</span>:indlnb(buffer)) <b>//</b> <span style='color:#bf0303;'>'&gt;'</span>
      buffer <b>=</b> <span style='color:#bf0303;'>' '</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'indlnb(buffer) = '</span>, indlnb(buffer)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through indlnb usage'</span>)

      <b>call</b> prompt(<span style='color:#bf0303;'>'Through fdemo2'</span>)

      <b>stop</b>
      <b>end</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Prints a message on stdout and then waits for input </span>
<span style='color:#898887;'>c     from stdin.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>subroutine</b> prompt(pstring)

         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>) pstring
         <span style='color:#0057ae;'>integer</span>       rc
         <span style='color:#0057ae;'>character*1</span>   resp

         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> pstring
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Enter any non-blank character &amp; '</span><b>//</b>
     <b>&amp;</b>              <span style='color:#bf0303;'>'enter to continue'</span>
         <span style='color:#006060;'>read(*</span>,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>end</span><b>=</b><span style='color:#b08000;'>900</span><span style='color:#006060;'>)</span>  resp
         <b>return</b>
 
 <span style='color:#b08000;'>900</span>     <b>continue</b>
         <b>stop</b>
      <b>end</b> 

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Returns index of last non-blank character in 's',</span>
<span style='color:#898887;'>c     or 0 if the string is completely blank. </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span> <b>function</b> indlnb(s)
 
         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)    s
 
         <b>do</b> indlnb <b>=</b> <b><i><span style='color:#000060;'>len</span></i></b>(s) , <span style='color:#b08000;'>1</span> , <b>-</b><span style='color:#b08000;'>1</span>
            <b>if</b>( s(indlnb:indlnb) <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#bf0303;'>' '</span> ) <b>return</b>
         <b>end do</b>
         indlnb <b>=</b> <span style='color:#b08000;'>0</span>
 
         <b>return</b>
 
      <b>end</b>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Hello World!'</span>
      <b>stop</b>
      <b>end</b>
      <b>program</b>  greeting

      <b>call</b> sayhello()

      <b>stop</b>
      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Computes and reports estimate of machine epsilon.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Recall: machine epsilon is smallest positive 'eps' </span>
<span style='color:#898887;'>c     such that </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c             (1.0d0 + eps ) .ne. (1.0d0)</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Program accepts optional argument which specifies </span>
<span style='color:#898887;'>c     division factor: values close to 1.0 will result </span>
<span style='color:#898887;'>c     in more accurate estimate of machine epsilon.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         meps

      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Note use of 'r8arg', available in 'libp410f.a' which</span>
<span style='color:#898887;'>c     works exactly like 'i4arg' except that it returns </span>
<span style='color:#898887;'>c     a real*8 value parsed from the specified command-line</span>
<span style='color:#898887;'>c     argument</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>          r8arg

      <span style='color:#0057ae;'>real*8</span>          default_fac
      <span style='color:#0057ae;'>parameter</span>     ( default_fac <b>=</b> <span style='color:#b08000;'>2.0d0</span> )

      <span style='color:#0057ae;'>real*8</span>          eps,         neweps,        fac

      fac <b>=</b> r8arg(<span style='color:#b08000;'>1</span>,default_fac)
      <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'meps: using division factor: '</span>, fac

      eps    <b>=</b> <span style='color:#b08000;'>1.0d0</span>
      neweps <b>=</b> <span style='color:#b08000;'>1.0d0</span>
      <b>do</b> <b>while</b>( <span style='color:#b08000;'>1.0d0</span> <b><span style='color:#008000;'>.ne.</span></b> (<span style='color:#b08000;'>1.0d0</span> <b>+</b> neweps) )
         eps    <b>=</b> neweps
         neweps <b>=</b> neweps <b>/</b> fac
      <b>end do</b>

      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> eps

      <b>stop</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     mysum:  reads numbers one per line from stdin</span>
<span style='color:#898887;'>c     and writes sum on stdout.  Ignores invalid inputs</span>
<span style='color:#898887;'>c     but counts number encountered and reports on stderr.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>      mysum

      <b>implicit</b>     <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     vi:    Current number read from stdin</span>
<span style='color:#898887;'>c     sum:   Current sum of numbers read</span>
<span style='color:#898887;'>c     rc:    For storing return status from READ</span>
<span style='color:#898887;'>c     nbad:  Count of number of bad inputs</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>       vi,         <b><span style='color:#600060;'>sum</span></b>
      <span style='color:#0057ae;'>integer</span>      rc,         nbad

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Initialize ...</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      nbad <b>=</b> <span style='color:#b08000;'>0</span>
      <b><span style='color:#600060;'>sum</span></b>  <b>=</b> <span style='color:#b08000;'>0.0d0</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The following construct is roughly equivalent to </span>
<span style='color:#898887;'>c     a while loop, execution keeps returning to the </span>
<span style='color:#898887;'>c     top of the loop until end of file is detected on </span>
<span style='color:#898887;'>c     stdin.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
 <span style='color:#b08000;'>100</span>  <b>continue</b>
         <span style='color:#006060;'>read(*</span>,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>end</span><b>=</b><span style='color:#b08000;'>200</span><span style='color:#006060;'>)</span>  vi
         <b>if</b>( rc <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           Read a bona fide real*8 value, update sum.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            <b><span style='color:#600060;'>sum</span></b> <b>=</b> <b><span style='color:#600060;'>sum</span></b> <b>+</b> vi
         <b>else</b> 
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           Input was invalid.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            nbad <b>=</b> nbad <b>+</b> <span style='color:#b08000;'>1</span>
         <b>end if</b>
      <b>go</b> <b>to</b> <span style='color:#b08000;'>100</span>
 <span style='color:#b08000;'>200</span>  <b>continue</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Write sum on standard output.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <b><span style='color:#600060;'>sum</span></b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Report # of invalid inputs only if there were some.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>if</b>( nbad <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Unit 0 is stderr (standard error) on most Unix </span>
<span style='color:#898887;'>c        systems: if you redirect stdin using '&gt;' and this </span>
<span style='color:#898887;'>c        message is tripped, it will still appear on the </span>
<span style='color:#898887;'>c        terminal.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> nbad, <span style='color:#bf0303;'>' invalid inputs'</span>
      <b>end if</b>

      <b>stop</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     go-to-less version of mysum.  No more or less correct</span>
<span style='color:#898887;'>c     than go-to-full version, of course, but some would assert </span>
<span style='color:#898887;'>c     that this version is &quot;cleaner&quot;/&quot;safer&quot; in some sense, </span>
<span style='color:#898887;'>c     or at the very least, better stylistically.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>      mysum

      <b>implicit</b>     <b>none</b>

      <span style='color:#0057ae;'>real*8</span>       vi,         <b><span style='color:#600060;'>sum</span></b>
      <span style='color:#0057ae;'>integer</span>      rc,         rceof,     nbad

      nbad <b>=</b> <span style='color:#b08000;'>0</span>
      <b><span style='color:#600060;'>sum</span></b>  <b>=</b> <span style='color:#b08000;'>0.0d0</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     'rc' will be set to a NEGATIVE value when end of file</span>
<span style='color:#898887;'>c     is encountered.  Initialize 'rc' to 0 to ensure that </span>
<span style='color:#898887;'>c     we get into the 'do while' loop.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      rc <b>=</b> <span style='color:#b08000;'>0</span>
      <b>do</b> <b>while</b> ( rc <b><span style='color:#008000;'>.ge.</span></b> <span style='color:#b08000;'>0</span> ) 
         <span style='color:#006060;'>read(*</span>,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span>  vi
         <b>if</b>( rc <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <b><span style='color:#600060;'>sum</span></b> <b>=</b> <b><span style='color:#600060;'>sum</span></b> <b>+</b> vi
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           New logic to ensure that EOF doesn't get counted </span>
<span style='color:#898887;'>c           as a bad input.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>else if</b> ( rc <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            nbad <b>=</b> nbad <b>+</b> <span style='color:#b08000;'>1</span>
         <b>end if</b>
      <b>end do</b>

      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <b><span style='color:#600060;'>sum</span></b>

      <b>if</b>( nbad <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> nbad, <span style='color:#bf0303;'>' invalid inputs'</span>
      <b>end if</b>

      <b>stop</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Less-commented (i.e. more reasonable level of </span>
<span style='color:#898887;'>c     comments) version of mysum.</span>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     mysum_s:  reads numbers one per line from stdin</span>
<span style='color:#898887;'>c     and writes sum on stdout.  Ignores invalid inputs</span>
<span style='color:#898887;'>c     but counts number encountered and reports on stderr.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>      mysum

      <b>implicit</b>     <b>none</b>

      <span style='color:#0057ae;'>real*8</span>       vi,         <b><span style='color:#600060;'>sum</span></b>
      <span style='color:#0057ae;'>integer</span>      rc,         nbad

      nbad <b>=</b> <span style='color:#b08000;'>0</span>
      <b><span style='color:#600060;'>sum</span></b>  <b>=</b> <span style='color:#b08000;'>0.0d0</span>

 <span style='color:#b08000;'>100</span>  <b>continue</b>
         <span style='color:#006060;'>read(*</span>,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>end</span><b>=</b><span style='color:#b08000;'>200</span><span style='color:#006060;'>)</span>  vi
         <b>if</b>( rc <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <b><span style='color:#600060;'>sum</span></b> <b>=</b> <b><span style='color:#600060;'>sum</span></b> <b>+</b> vi
         <b>else</b> 
            nbad <b>=</b> nbad <b>+</b> <span style='color:#b08000;'>1</span>
         <b>end if</b>
      <b>go</b> <b>to</b> <span style='color:#b08000;'>100</span>
 <span style='color:#b08000;'>200</span>  <b>continue</b>

      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <b><span style='color:#600060;'>sum</span></b>

      <b>if</b>( nbad <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> nbad, <span style='color:#bf0303;'>' invalid inputs'</span>
      <b>end if</b>

      <b>stop</b>

      <b>end</b>
      <b>subroutine</b> sayhello()
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Hello World!'</span>
         <b>return</b>
      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Program to test understanding of Fortran 77 array</span>
<span style='color:#898887;'>c     storage scheme.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     EXERCISE:  Predict program output.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>     t2d

      <b>implicit</b>    <b>none</b>

      <span style='color:#0057ae;'>integer</span>     n,      m 
      <span style='color:#0057ae;'>parameter</span> ( n <b>=</b> <span style='color:#b08000;'>3</span>,  m <b>=</b> <span style='color:#b08000;'>4</span> )

      <span style='color:#0057ae;'>real*8</span>      a(n,m),   aij
      <span style='color:#0057ae;'>integer</span>     i,        j

      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n
         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , m
            a(i,j) <b>=</b> <span style='color:#b08000;'>100.0d0</span> <b>*</b> i <b>+</b> m
         <b>end do</b>
      <b>end do</b>

      <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'main: a(2,2) = '</span>, a(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>2</span>)

      <b>call</b> sub(a,<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>2</span>)

      <b>stop</b>

      <b>end</b>

      <b>subroutine</b> sub(a,n,m)

         <b>implicit</b>      <b>none</b>
         <span style='color:#0057ae;'>integer</span>       n,      m
         <span style='color:#0057ae;'>real*8</span>        a(n,m)

         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'sub: a(2,2) = '</span>, a(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>2</span>)

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstration main program, subroutines and functions</span>
<span style='color:#898887;'>c     to illustrate RECOMMENDED use of common blocks </span>
<span style='color:#898887;'>c     using 'include' statement.  Safe Fortran 77 </span>
<span style='color:#898887;'>c     extension.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         tcommon1

      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     By convention, I use the extension '.inc' for </span>
<span style='color:#898887;'>c     Fortran source files which are to be included.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>include</b>        <span style='color:#bf0303;'>'coma.inc'</span>

      string <b>=</b> <span style='color:#bf0303;'>'foo'</span>
      v(<span style='color:#b08000;'>1</span>) <b>=</b> <span style='color:#b08000;'>1.0d0</span>
      v(<span style='color:#b08000;'>2</span>) <b>=</b> <span style='color:#b08000;'>2.0d0</span>
      v(<span style='color:#b08000;'>3</span>) <b>=</b> <span style='color:#b08000;'>3.0d0</span>
      x <b>=</b> <span style='color:#b08000;'>10.0d0</span>
      y <b>=</b> <span style='color:#b08000;'>20.0d0</span>
      z <b>=</b> <span style='color:#b08000;'>30.0d0</span>
      i <b>=</b> <span style='color:#b08000;'>314</span>

      <b>call</b> subcom()

      <b>stop</b>
      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     This subroutine dumps information passed to it in</span>
<span style='color:#898887;'>c     a common block.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b>  subcom()
         
         <b>include</b>       <span style='color:#bf0303;'>'coma.inc'</span>

         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'In subcom:'</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'string = '</span>, string
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'v = '</span>, v
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'x = '</span>, x, <span style='color:#bf0303;'>' y = '</span>, y, <span style='color:#bf0303;'>' z = '</span>, z
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'i = '</span>, i

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstration main program and subroutine</span>
<span style='color:#898887;'>c     to illustrate use of COMMON blocks for creating </span>
<span style='color:#898887;'>c     'global' storage.  Common blocks should always </span>
<span style='color:#898887;'>c     be labelled (named) and should be used sparingly.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         tcommon

      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Declare variables to be placed in common block </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>character*16</span>    string
      <span style='color:#0057ae;'>real*8</span>          v(<span style='color:#b08000;'>3</span>),        
     <b>&amp;</b>                x,             y,            z
      <span style='color:#0057ae;'>integer</span>         i
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Variables are stored in a common block in the </span>
<span style='color:#898887;'>c     order in which they are specified in the 'common'</span>
<span style='color:#898887;'>c     statement. ALWAYS order variables from longest to </span>
<span style='color:#898887;'>c     shortest to avoid &quot;alignment problems&quot;.  Don't </span>
<span style='color:#898887;'>c     try to put a variable in more than one common block</span>
<span style='color:#898887;'>c     and note that entire arrays (such as 'v') are placed</span>
<span style='color:#898887;'>c     in the common block by simply specifying the name</span>
<span style='color:#898887;'>c     of the array.  Finally, note that variables in a </span>
<span style='color:#898887;'>c     common block CAN NOT be initialized with a 'data'</span>
<span style='color:#898887;'>c     statement.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>common</b>   <b>/</b> coma <b>/</b>
     <b>&amp;</b>                string,
     <b>&amp;</b>                v,                                
     <b>&amp;</b>                x,             y,            z,
     <b>&amp;</b>                i

      string <b>=</b> <span style='color:#bf0303;'>'foo'</span>
      v(<span style='color:#b08000;'>1</span>) <b>=</b> <span style='color:#b08000;'>1.0d0</span>
      v(<span style='color:#b08000;'>2</span>) <b>=</b> <span style='color:#b08000;'>2.0d0</span>
      v(<span style='color:#b08000;'>3</span>) <b>=</b> <span style='color:#b08000;'>3.0d0</span>
      x <b>=</b> <span style='color:#b08000;'>10.0d0</span>
      y <b>=</b> <span style='color:#b08000;'>20.0d0</span>
      z <b>=</b> <span style='color:#b08000;'>30.0d0</span>
      i <b>=</b> <span style='color:#b08000;'>314</span>

      <b>call</b> subcom()

      <b>stop</b>
      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     This subroutine dumps information passed to it in</span>
<span style='color:#898887;'>c     a common block.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b>  subcom()
         
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Overall layout of common block should be identical </span>
<span style='color:#898887;'>c     in all program units which use the common block.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#0057ae;'>character*16</span>    string
         <span style='color:#0057ae;'>real*8</span>          v(<span style='color:#b08000;'>3</span>),
     <b>&amp;</b>                   x,             y,            z
         <span style='color:#0057ae;'>integer</span>         i

         <b>common</b>   <b>/</b> coma <b>/</b>
     <b>&amp;</b>                   string,
     <b>&amp;</b>                   v,
     <b>&amp;</b>                   x,             y,            z,
     <b>&amp;</b>                   i

         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'In subcom:'</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'string = '</span>, string
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'v = '</span>, v
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'x = '</span>, x, <span style='color:#bf0303;'>' y = '</span>, y, <span style='color:#bf0303;'>' z = '</span>, z
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'i = '</span>, i

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c-------------------------------------------------</span>
<span style='color:#898887;'>c    Simple illustration of use of libraries</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c    dmach is a function defined in the LINPACK</span>
<span style='color:#898887;'>c    library</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c    /usr/local/PGI/lib/liblinpack.a</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c    It computes and returns information </span>
<span style='color:#898887;'>c    concerning the invoking machine's floating </span>
<span style='color:#898887;'>c    point  model.</span>
<span style='color:#898887;'>c-------------------------------------------------</span>
      <b>program</b>    tdmach

      <b>implicit</b>   <b>none</b>

      <span style='color:#0057ae;'>real*8</span>     dmach

      <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> dmach(<span style='color:#b08000;'>1</span>)

      <b>stop</b>  
      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Test program for subroutine 'dmfrom', 'dmto' and </span>
<span style='color:#898887;'>c     'dmmmult' (see 'dmroutines.f')</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Program expects one argument, the name of a file which</span>
<span style='color:#898887;'>c     contains a real*8 square matrix written as descibed </span>
<span style='color:#898887;'>c     in the documentation for 'dmfrom' in 'dmroutines.f'</span>
<span style='color:#898887;'>c     Use '-' to read from stdin.  Program then computes </span>
<span style='color:#898887;'>c     square of matrix and outputs result to stdout.</span>
<span style='color:#898887;'>c===========================================================</span>

      <b>program</b>         tdm

      <b>implicit</b>        <b>none</b>

      <span style='color:#0057ae;'>integer</span>         iargc

      <span style='color:#0057ae;'>character*256</span>   fname

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Maximum size for input and output arrays (matrices).</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         maxsize
      <span style='color:#0057ae;'>parameter</span>     ( maxsize <b>=</b> <span style='color:#b08000;'>100</span> <span style='color:#b08000;'>000</span> )
      <span style='color:#0057ae;'>real*8</span>          a(maxsize),   asq(maxsize)
      <span style='color:#0057ae;'>integer</span>         d1a,          d2a       

      <b>if</b>( iargc() <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>1</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
      <b>call</b> getarg(<span style='color:#b08000;'>1</span>,fname)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Read matrix ...</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dmfrom(fname,a,d1a,d2a,maxsize)
      <b>if</b>( d1a <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span>  <b><span style='color:#008000;'>.and.</span></b>  d2a <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
         <b>if</b>( d1a <b><span style='color:#008000;'>.eq.</span></b> d2a ) <b>then</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           Compute square ...</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            <b>call</b> dmmmult(a,a,asq,d1a,d1a)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           ... and output.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            <b>call</b> dmto(<span style='color:#bf0303;'>'-'</span>,asq,d1a,d1a)
         <b>else</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'tdm: Input array not square'</span>
         <b>end if</b>
      <b>else</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'tdm: dmfrom() failed'</span>
      <b>end if</b>

      <b>stop</b>

 <span style='color:#b08000;'>900</span>  <b>continue</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'usage: tdm &lt;file name&gt;'</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'       Use ''tdm -'' to read '</span>,
     <b>&amp;</b>              <span style='color:#bf0303;'>'from standard input'</span>

      <b>stop</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstrates use of the real*8 (pseudo-)random number </span>
<span style='color:#898887;'>c     generator, 'drand48' available on the lnx machines via</span>
<span style='color:#898887;'>c     the 'p410f' utility library.</span>
<span style='color:#898887;'>c </span>
<span style='color:#898887;'>c     usage: tdrand48 &lt;nrand&gt; [&lt;seed&gt;]</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     where &lt;nrand&gt; is the number of random numbers on the </span>
<span style='color:#898887;'>c     interval (0..1) to be generated, and &lt;seed&gt; is the </span>
<span style='color:#898887;'>c     optional, integer-valued &quot;seed&quot; for the random number </span>
<span style='color:#898887;'>c     generator.  </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     The program outputs the random numbers generated to </span>
<span style='color:#898887;'>c     standard output (one per line), and their average to </span>
<span style='color:#898887;'>c     standard error.  In the limit of very large &lt;nrand&gt;, </span>
<span style='color:#898887;'>c     this average should approach 0.5 since 'drand48' </span>
<span style='color:#898887;'>c     generates numbers uniformly distributed on the unit </span>
<span style='color:#898887;'>c     interval.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Note carefully that for fixed seed, 'drand48' (and </span>
<span style='color:#898887;'>c     most other pseudo-random number generators) will </span>
<span style='color:#898887;'>c     ALWAYS RETURN THE SAME SEQUENCE OF NUMBERS!  In </span>
<span style='color:#898887;'>c     fact, the purpose of seeding the generator is precisely</span>
<span style='color:#898887;'>c     to produce variation (&quot;randomness&quot;) in the sequence</span>
<span style='color:#898887;'>c     of iterates produced.  If 'drand48' is not explicitly </span>
<span style='color:#898887;'>c     seeded via 'srand48' a specific default seed value is </span>
<span style='color:#898887;'>c     used.   </span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         tdrand48

      <b>implicit</b>        <b>none</b>

      <span style='color:#0057ae;'>integer</span>         iargc,       i4arg
      <span style='color:#0057ae;'>real*8</span>          drand48

      <span style='color:#0057ae;'>real*8</span>          ranval,      <b><span style='color:#600060;'>sum</span></b>
      <span style='color:#0057ae;'>integer</span>         i,           nrand

      <b>if</b>( iargc() <b><span style='color:#008000;'>.lt.</span></b> <span style='color:#b08000;'>1</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
      nrand <b>=</b> i4arg(<span style='color:#b08000;'>1</span>,<b>-</b><span style='color:#b08000;'>1</span>)
      <b>if</b>( nrand <b><span style='color:#008000;'>.le.</span></b> <span style='color:#b08000;'>0</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
      <b>if</b>( iargc() <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>1</span> ) <b>then</b>
         <b>call</b> srand48(i4arg(<span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>0</span>))
      <b>end if</b>

      <b><span style='color:#600060;'>sum</span></b> <b>=</b> <span style='color:#b08000;'>0.0d0</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , nrand
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Generate a random number</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         ranval <b>=</b> drand48()
         <b><span style='color:#600060;'>sum</span></b> <b>=</b> <b><span style='color:#600060;'>sum</span></b> <b>+</b> ranval
      <b>end do</b>

      <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> 
      <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Average: '</span>, <b><span style='color:#600060;'>sum</span></b> <b>/</b> nrand

      <b>stop</b>

 <span style='color:#b08000;'>900</span>  <b>continue</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'usage: tdrand48 &lt;nrand&gt; [&lt;seed&gt;]'</span>
      <b>stop</b>
      <b>end</b>
      
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Returns a double precision vector (one-dimensional </span>
<span style='color:#898887;'>c     array) read from file 'fname'.  If 'fname' is the </span>
<span style='color:#898887;'>c     string '-', the vector is read from standard input.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     The file should contain one number per line; invalid </span>
<span style='color:#898887;'>c     input is ignored.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     This routine illustrates  a general technique for </span>
<span style='color:#898887;'>c     reading data from a FORMATTED (ASCII) file.  In</span>
<span style='color:#898887;'>c     Fortran, one associates a &quot;logical unit number&quot;</span>
<span style='color:#898887;'>c     (an integer) with a file via the OPEN statement.</span>
<span style='color:#898887;'>c     The unit number can then be used as the first </span>
<span style='color:#898887;'>c     &quot;argument&quot; of the READ and WRITE statements to </span>
<span style='color:#898887;'>c     perform input and output on the file. </span>
<span style='color:#898887;'>c     </span>
<span style='color:#898887;'>c     Fortran reserves the following unit numbers:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     5      terminal input (stdin) </span>
<span style='color:#898887;'>c     6      terminal output (stdout) </span>
<span style='color:#898887;'>c     0      error output on Unix systems (stderr)  </span>
<span style='color:#898887;'>c===========================================================</span>

      <b>subroutine</b> dvfrom(fname,v,n,maxn)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Arguments:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        fname:  (I)    File name</span>
<span style='color:#898887;'>c        v:      (O)    Return vector</span>
<span style='color:#898887;'>c        n:      (O)    Length of v (# read)</span>
<span style='color:#898887;'>c        maxn:   (I)    Maximum number to read</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>implicit</b>         <b>none</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        The integer functions 'indlnb' and 'getu' are </span>
<span style='color:#898887;'>c        defined in the 'p410f' library.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#0057ae;'>integer</span>          indlnb,      getu
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Declaration of routine arguments: note </span>
<span style='color:#898887;'>c        &quot;adjustable dimensioning&quot; of v; any array which </span>
<span style='color:#898887;'>c        is declared with adjustable dimensions must be </span>
<span style='color:#898887;'>c        a subroutine argument; any adjustable dimensions</span>
<span style='color:#898887;'>c        must also be subroutine arguments.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)    fname
         <span style='color:#0057ae;'>integer</span>          n,           maxn
         <span style='color:#0057ae;'>real*8</span>           v(maxn)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Programming style: Use parameter (ustdin) rather </span>
<span style='color:#898887;'>c        than constant value (5) for stdin logical unit #</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#0057ae;'>integer</span>          ustdin
         <span style='color:#0057ae;'>parameter</span>      ( ustdin <b>=</b> <span style='color:#b08000;'>5</span> )

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Local variables:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        vn:     Current number read from input</span>
<span style='color:#898887;'>c        ufrom:  Logical unit number for READ </span>
<span style='color:#898887;'>c        rc:     For storing return status from READ</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#0057ae;'>real*8</span>           vn
         <span style='color:#0057ae;'>integer</span>          ufrom,       rc

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Intialize </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         n <b>=</b> <span style='color:#b08000;'>0</span>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Read from stdin?</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>if</b>( fname <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#bf0303;'>'-'</span> ) <b>then</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           Set unit number to stdin default</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            ufrom <b>=</b> ustdin
         <b>else</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           Get an available unit number</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            ufrom <b>=</b> getu()
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c           Open the file for formatted I/O </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
            <span style='color:#006060;'>open(</span>ufrom,<span style='color:#006060;'>file</span><b>=</b>fname(<span style='color:#b08000;'>1</span>:indlnb(fname)),
     <b>&amp;</b>           <span style='color:#006060;'>form</span><b>=</b><span style='color:#bf0303;'>'formatted'</span>,<span style='color:#006060;'>status</span><b>=</b><span style='color:#bf0303;'>'old'</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span>
            <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c              Couldn't open the file, print error message</span>
<span style='color:#898887;'>c              and return.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
               <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dvfrom: Error opening '</span>,
     <b>&amp;</b>                    fname(<span style='color:#b08000;'>1</span>:indlnb(fname))
               <b>return</b>
            <b>end if</b>
         <b>end if</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Input numbers into vector (one per line) until</span>
<span style='color:#898887;'>c        EOF or maximum allowable number read</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
 <span style='color:#b08000;'>100</span>     <b>continue</b>
            <span style='color:#006060;'>read(</span>ufrom,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>end</span><b>=</b><span style='color:#b08000;'>200</span><span style='color:#006060;'>)</span>  vn
            <b>if</b>( rc <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
               n <b>=</b> n <b>+</b> <span style='color:#b08000;'>1</span>
               <b>if</b>( n <b><span style='color:#008000;'>.gt.</span></b> maxn ) <b>then</b>
                  <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span>  <span style='color:#bf0303;'>'dvfrom: Read maximum of '</span>,
     <b>&amp;</b>                         maxn, <span style='color:#bf0303;'>' from '</span>, 
     <b>&amp;</b>                         fname(<span style='color:#b08000;'>1</span>:indlnb(fname))
                     n <b>=</b> maxn 
                     <b>go</b> <b>to</b> <span style='color:#b08000;'>200</span>
               <b>end if</b>
               v(n) <b>=</b> vn
            <b>end if</b>
         <b>go</b> <b>to</b> <span style='color:#b08000;'>100</span>
 <span style='color:#b08000;'>200</span>     <b>continue</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        If we are reading from a file, close the file.</span>
<span style='color:#898887;'>c        This releases the unit number for subsequent use.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>if</b>( ufrom <b><span style='color:#008000;'>.ne.</span></b> ustdin ) <b>then</b>
            <span style='color:#006060;'>close(</span>ufrom<span style='color:#006060;'>)</span>
         <b>end if</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Test program for subroutine 'dvfrom'.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Program expects one argument which is the filename</span>
<span style='color:#898887;'>c     to be passed to 'dvfrom'</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         tdvfrom

      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The integer function 'iargc' returns the number of</span>
<span style='color:#898887;'>c     arguments supplied to the program.  It is </span>
<span style='color:#898887;'>c     automatically available to all Fortran programs on </span>
<span style='color:#898887;'>c     most Unix systems, as is 'getarg' (see below).</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         iargc,      indlnb

      <span style='color:#0057ae;'>integer</span>         maxn
      <span style='color:#0057ae;'>parameter</span>     ( maxn <b>=</b> <span style='color:#b08000;'>100</span> <span style='color:#b08000;'>000</span> )
      <span style='color:#0057ae;'>real*8</span>          v(maxn)
      <span style='color:#0057ae;'>integer</span>         n

      <span style='color:#0057ae;'>character*256</span>   fname

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Unless exactly one argument is supplied, print usage</span>
<span style='color:#898887;'>c     message and exit.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>if</b>( iargc() <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>1</span> ) <b>then</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'usage: tdvfrom &lt;file name&gt;'</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> 
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'       Use ''tdvfrom -'' to read '</span>,
     <b>&amp;</b>              <span style='color:#bf0303;'>'from standard input'</span>
         <b>stop</b>
      <b>end if</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The subroutine 'getarg' (Unix) takes 2 arguments.</span>
<span style='color:#898887;'>c     The first is an integer input argument specifying </span>
<span style='color:#898887;'>c     which argument is to be fetched, the second is </span>
<span style='color:#898887;'>c     a character output argument which, on return,</span>
<span style='color:#898887;'>c     contains the fetched argument.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Get the filename.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> getarg(<span style='color:#b08000;'>1</span>,fname)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Call the routine ...</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dvfrom(fname,v,n,maxn)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     ... and report how many numbers were read.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'tdvfrom: '</span>, n, <span style='color:#bf0303;'>' read from '</span><b>//</b>
     <b>&amp;</b>           fname(<span style='color:#b08000;'>1</span>:indlnb(fname))

      <b>stop</b>
      <b>end</b>


<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Writes a double precision vector to file 'fname'.</span>
<span style='color:#898887;'>c     If fname is the string '-' then the vector is written</span>
<span style='color:#898887;'>c     to standard output.</span>
<span style='color:#898887;'>c===========================================================</span>

      <b>subroutine</b> dvto(fname,v,n)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Arguments:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        fname:  (I)    File name</span>
<span style='color:#898887;'>c        v:      (I)    Vector to be written</span>
<span style='color:#898887;'>c        n:      (I)    Length of vector</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>implicit</b>         <b>none</b>

         <span style='color:#0057ae;'>integer</span>          getu,       indlnb

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)    fname
         <span style='color:#0057ae;'>integer</span>          n
         <span style='color:#0057ae;'>real*8</span>           v(n)

         <span style='color:#0057ae;'>integer</span>          ustdout
         <span style='color:#0057ae;'>parameter</span>      ( ustdout <b>=</b> <span style='color:#b08000;'>6</span> )

         <span style='color:#0057ae;'>integer</span>          i,      uto,       rc

         <b>if</b>( fname <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#bf0303;'>'-'</span> ) <b>then</b>
            uto <b>=</b> ustdout
         <b>else</b>
            uto <b>=</b> getu()
            <span style='color:#006060;'>open(</span>uto,<span style='color:#006060;'>file</span><b>=</b>fname(<span style='color:#b08000;'>1</span>:indlnb(fname)),
     <b>&amp;</b>           <span style='color:#006060;'>form</span><b>=</b><span style='color:#bf0303;'>'formatted'</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span>
            <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
               <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dvto: Error opening '</span>,
     <b>&amp;</b>                    fname(<span style='color:#b08000;'>1</span>:indlnb(fname))
               <b>return</b>
            <b>end if</b>
         <b>end if</b>

         <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n
            <span style='color:#006060;'>write(</span>uto,<span style='color:#006060;'>*)</span> v(i)
         <b>end do</b>

         <b>if</b>( uto <b><span style='color:#008000;'>.ne.</span></b> ustdout ) <b>then</b>
            <span style='color:#006060;'>close(</span>uto<span style='color:#006060;'>)</span>
         <b>end if</b>

         <b>return</b>

      <b>end</b>
      
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Test program for subroutine 'dvto'.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Program expects two arguments, the name of a file </span>
<span style='color:#898887;'>c     for output ('-' for stdout) and the length of the </span>
<span style='color:#898887;'>c     test vector to be written.</span>
<span style='color:#898887;'>c===========================================================</span>

      <b>program</b>         tdvto

      <b>implicit</b>        <b>none</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The integer function 'i4arg' is defined in the </span>
<span style='color:#898887;'>c     'p410f' library.  It takes two arguments, the first </span>
<span style='color:#898887;'>c     is an integer specifying which program argument is </span>
<span style='color:#898887;'>c     to be parsed as an integer, and the second is a </span>
<span style='color:#898887;'>c     default value which will be returned if the argument</span>
<span style='color:#898887;'>c     was not supplied or could not be converted to an </span>
<span style='color:#898887;'>c     integer.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         iargc,      i4arg

      <span style='color:#0057ae;'>integer</span>         maxn
      <span style='color:#0057ae;'>parameter</span>     ( maxn <b>=</b> <span style='color:#b08000;'>100</span> <span style='color:#b08000;'>000</span> )
      <span style='color:#0057ae;'>real*8</span>          v(maxn)
      <span style='color:#0057ae;'>integer</span>         n

      <span style='color:#0057ae;'>integer</span>         i
      <span style='color:#0057ae;'>character*256</span>   fname

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Unless exactly two arguments are supplied, print usage</span>
<span style='color:#898887;'>c     message and exit.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Note the use of the &quot;logical-if&quot; statement (no then)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>if</b>( iargc() <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>2</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>

      <b>call</b> getarg(<span style='color:#b08000;'>1</span>,fname)
      n <b>=</b> i4arg(<span style='color:#b08000;'>2</span>,<b>-</b><span style='color:#b08000;'>1</span>)
      <b>if</b>( n <b><span style='color:#008000;'>.eq.</span></b> <b>-</b><span style='color:#b08000;'>1</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Limit the value of n</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      n <b>=</b> <b><span style='color:#600060;'>min</span></b>(n,maxn)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Define test vector</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n
         v(i) <b>=</b> i 
      <b>end do</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Call the routine ..</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dvto(fname,v,n)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Normal exit</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>stop</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Usage exit</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
 <span style='color:#b08000;'>900</span>  <b>continue</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'usage: tdvto &lt;file name&gt; &lt;n&gt;'</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'       Use ''tdvto -'' to write '</span>,
     <b>&amp;</b>              <span style='color:#bf0303;'>'to standard output'</span>

      <b>stop</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstration main program and subprograms </span>
<span style='color:#898887;'>c     illustrating the 'EXTERNAL' statement and how </span>
<span style='color:#898887;'>c     subprograms may be passed as ARGUMENTS to other </span>
<span style='color:#898887;'>c     subprograms.  This technique is often used to </span>
<span style='color:#898887;'>c     pass &quot;user-defined&quot; functions to routines which </span>
<span style='color:#898887;'>c     can do generic things with such functions (such </span>
<span style='color:#898887;'>c     as integrating or differentiating them, for example).</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         texternal

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     The 'external' statement tells the compiler that the </span>
<span style='color:#898887;'>c     specified names are names of externally-defined </span>
<span style='color:#898887;'>c     subprograms (i.e. subroutines or functions)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>          r8fcn
      <b>external</b>        r8fcn,        r8sub2

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Call 'r8fcncaller' which then invokes 'r8fcn'</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> r8fcncaller(r8fcn)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Call 'r8subcaller' which then invokes 'r8sub2'</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> subcaller(r8sub2)

      <b>stop</b>
      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Input 'fcn' is the name of an externally defined </span>
<span style='color:#898887;'>c     real*8 function.  This routine invokes that function</span>
<span style='color:#898887;'>c     with argument 10.0d0 and writes the result on </span>
<span style='color:#898887;'>c     standard error</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b>  r8fcncaller(fcn)
         
         <b>implicit</b>     <b>none</b>

         <span style='color:#0057ae;'>real*8</span>       fcn
         <b>external</b>     fcn

         <span style='color:#0057ae;'>real*8</span>       fcnval

         fcnval <b>=</b> fcn(<span style='color:#b08000;'>10.0d0</span>)

         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'r8caller: '</span>, fcnval

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Input 'sub' is the name of an externally defined </span>
<span style='color:#898887;'>c     subroutine.  This routine invokes that subroutine</span>
<span style='color:#898887;'>c     with arguments 10.0d0 and 20.0d0.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b>  subcaller(sub)
         
         <b>implicit</b>     <b>none</b>

         <b>external</b>     sub

         <b>call</b> sub(<span style='color:#b08000;'>10.0d0</span>,<span style='color:#b08000;'>20.0d0</span>)

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Demonstration real*8 function</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span> <b>function</b> r8fcn(x)

         <b>implicit</b>     <b>none</b> 

         <span style='color:#0057ae;'>real*8</span>       x

         r8fcn <b>=</b> x<b>**</b><span style='color:#b08000;'>2</span>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstration subroutine</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> r8sub2(x,y)

         <b>implicit</b>     <b>none</b> 

         <span style='color:#0057ae;'>real*8</span>       x,       y

         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'r8sub: x = '</span>, x, <span style='color:#bf0303;'>' y = '</span>, y

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstration main program and subroutine to </span>
<span style='color:#898887;'>c     illustrate use of SAVE and DATA statements.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         tsavedata

      <b>implicit</b>        <b>none</b>

      <span style='color:#0057ae;'>integer</span>         i

      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>10</span>
         <b>call</b> sub1()
      <b>end do</b>

      <b>stop</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Subprogram 'sub1': writes a message to standard </span>
<span style='color:#898887;'>c     error the FIRST time it is called, and writes </span>
<span style='color:#898887;'>c     the number of times it has been called so far to</span>
<span style='color:#898887;'>c     standard output EVERY time it is called. </span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> sub1()
      
         <b>implicit</b>     <b>none</b>

         <span style='color:#0057ae;'>logical</span>      first 
         <span style='color:#0057ae;'>integer</span>      ncall
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Strict f77 statement ordering demands that </span>
<span style='color:#898887;'>c        ANY DATA statements appear after ALL variable </span>
<span style='color:#898887;'>c        declarations.  Note the use of '/' to delimit the </span>
<span style='color:#898887;'>c        initialization value.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#0057ae;'>         data</span>         first <b>/</b> <b><span style='color:#800080;'>.true.</span></b> <b>/</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        This 'save' statement guarantees that ALL local </span>
<span style='color:#898887;'>c        storage is preserved between calls.   </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#0057ae;'>save</span>

         <b>if</b>( first ) <b>then</b>
            ncall <b>=</b> <span style='color:#b08000;'>1</span>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'First call to sub1'</span>
            first <b>=</b> <b><span style='color:#800080;'>.false.</span></b>
         <b>end if</b>

         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'sub1: Call '</span>, ncall
         ncall <b>=</b> ncall <b>+</b> <span style='color:#b08000;'>1</span>

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Demonstration main program, subroutines and functions</span>
<span style='color:#898887;'>c     to illustrate argument passing (call by address) in</span>
<span style='color:#898887;'>c     Fortran.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         tsub

      <span style='color:#0057ae;'>real*8</span>          r8side

      <span style='color:#0057ae;'>integer</span>         n 
      <span style='color:#0057ae;'>parameter</span>     ( n <b>=</b> <span style='color:#b08000;'>6</span> )
      <span style='color:#0057ae;'>real*8</span>          v1(n)
      <span style='color:#0057ae;'>real*8</span>          a,             b

      a <b>=</b> <b>-</b><span style='color:#b08000;'>1.0d0</span> 
      b <b>=</b>  <span style='color:#b08000;'>1.0d0</span> 
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Pre r8swap: a = '</span>, a, <span style='color:#bf0303;'>' b = '</span>, b
      <b>call</b> r8swap(a,b)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Post r8swap: a = '</span>, a, <span style='color:#bf0303;'>' b = '</span>, b
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through r8swap'</span>)

      a <b>=</b> <span style='color:#b08000;'>10.0d0</span>
      b <b>=</b> r8side(a)
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Post r8side: a = '</span>, a, <span style='color:#bf0303;'>' b = '</span>, b
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through r8side'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Load 'v1' with 0.0d0</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dvloadsc(v1,n,<span style='color:#b08000;'>0.0d0</span>)
      <b>call</b> dvstderr(<span style='color:#bf0303;'>'v1 loaded with 0.0'</span>,v1,n)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through dvloadsc'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     'v1' and 'v1(1)' have the SAME ADDRESS and thus </span>
<span style='color:#898887;'>c     this call to 'dvloadsc' has precisely the same effect </span>
<span style='color:#898887;'>c     as the previous one.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dvloadsc(v1(<span style='color:#b08000;'>1</span>),n,<span style='color:#b08000;'>0.0d0</span>)
      <b>call</b> dvstderr(<span style='color:#bf0303;'>'v1 loaded with 0.0'</span>,v1,n)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through dvloadsc (second time)'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Load v(2:n-1) with 1.0d0, values 'v(1)' and 'v(n)'</span>
<span style='color:#898887;'>c     are unchanged</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dvloadsc(v1(<span style='color:#b08000;'>2</span>),n<b>-</b><span style='color:#b08000;'>2</span>,<span style='color:#b08000;'>1.0d0</span>)
      <b>call</b> dvstderr(<span style='color:#bf0303;'>'v1 loaded with 0.0 and 1.0'</span>,v1,n)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through dvloadsc (third time)'</span>)

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     It is actually a violation of strict F77 to pass </span>
<span style='color:#898887;'>c     the same address more than once to a subroutine </span>
<span style='color:#898887;'>c     or argument, but in many cases, such as this one </span>
<span style='color:#898887;'>c     it is perfectly safe.  This sequence uses the </span>
<span style='color:#898887;'>c     routine 'dvaddsc' to increment each value of 'v1'</span>
<span style='color:#898887;'>c     by 2.0d0.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dvaddsc(v1,v1,n,<span style='color:#b08000;'>2.0d0</span>)
      <b>call</b> dvstderr(<span style='color:#bf0303;'>'v1 incremented by 2.0'</span>,v1,n)
      <b>call</b> prompt(<span style='color:#bf0303;'>'Through dvaddsc'</span>)

      <b>call</b> prompt(<span style='color:#bf0303;'>'Through tsub'</span>)

      <b>stop</b>
      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     This routine swaps its two real*8 arguments</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b>  r8swap(val1,val2)
         
         <b>implicit</b>     <b>none</b>

         <span style='color:#0057ae;'>real*8</span>       val1,      val2
         <span style='color:#0057ae;'>real*8</span>       temp

         temp <b>=</b> val1 
         val1 <b>=</b> val2
         val2 <b>=</b> temp
         
         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Real*8 function 'r8side' which has the 'side effect' </span>
<span style='color:#898887;'>c     of overwriting its argument with 0.0d0.  As a general</span>
<span style='color:#898887;'>c     matter of style, Fortran FUNCTION subprograms should </span>
<span style='color:#898887;'>c     act like real functions (i.e. NO side-effects) where</span>
<span style='color:#898887;'>c     possible.  </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Also note that the name of a Fortran </span>
<span style='color:#898887;'>c     function is treated as a local variable in the </span>
<span style='color:#898887;'>c     subprogram source code and MUST be assigned a value </span>
<span style='color:#898887;'>c     before any 'return' statements are encountered.</span>
<span style='color:#898887;'>c===========================================================</span>
      <span style='color:#0057ae;'>real*8</span> <b>function</b> r8side(x)

         <b>implicit</b>     <b>none</b>

         <span style='color:#0057ae;'>real*8</span>       x
       
         r8side <b>=</b> x <b>*</b> x <b>*</b> x
         x <b>=</b> <span style='color:#b08000;'>0.0d0</span>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Loads output real*8 vector 'v' with input scalar </span>
<span style='color:#898887;'>c     value 'sc'.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> dvloadsc(v,n,sc)

         <b>implicit</b>      <b>none</b>
         
         <span style='color:#0057ae;'>integer</span>       n
         <span style='color:#0057ae;'>real*8</span>        v(n)
         <span style='color:#0057ae;'>real*8</span>        sc

         <span style='color:#0057ae;'>integer</span>       i
            
         <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n
            v(i) <b>=</b> sc
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Adds real*8 scalar to input real*8 vector 'v1',</span>
<span style='color:#898887;'>c     and returns results in output real*8 vector 'v2'</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> dvaddsc(v1,v2,n,sc)

         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>integer</span>       n
         <span style='color:#0057ae;'>real*8</span>        v1(n),      v2(n)
         <span style='color:#0057ae;'>real*8</span>        sc

         <span style='color:#0057ae;'>integer</span>       i
         
         <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n
            v2(i) <b>=</b> v1(i) <b>+</b> sc
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Dumps 'string' and the real*8 vector 'v' to stderr.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> dvstderr(string,v,n)
      
         <b>implicit</b>       <b>none</b>

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)  string
         <span style='color:#0057ae;'>integer</span>        n
         <span style='color:#0057ae;'>real*8</span>         v(n)
      
         <span style='color:#0057ae;'>integer</span>        i

         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> string
         <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> v(i)
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Prints a message on stdout and then waits for input</span>
<span style='color:#898887;'>c     from stdin.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> prompt(pstring)

         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>) pstring
         <span style='color:#0057ae;'>integer</span>       rc
         <span style='color:#0057ae;'>character*1</span>   resp

         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> pstring
         <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'Enter anything &amp; &lt;CR&gt; to continue'</span>
         <span style='color:#006060;'>read(*</span>,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>end</span><b>=</b><span style='color:#b08000;'>900</span><span style='color:#006060;'>)</span>  resp
         <b>return</b>

 <span style='color:#b08000;'>900</span>     <b>continue</b>
         <b>stop</b>
      <b>end</b>
      
<span style='color:#898887;'>!===========================================================</span>
<span style='color:#898887;'>!     arraydemo90.f:  Fortran 90 version of arraydemo.f</span>
<span style='color:#898887;'>!</span>
<span style='color:#898887;'>!     Fortran 90 implements run-time allocation of arrays </span>
<span style='color:#898887;'>!     and other data objects.</span>
<span style='color:#898887;'>! </span>
<span style='color:#898887;'>!     Array names are identified as dynamically allocated </span>
<span style='color:#898887;'>!     via the 'allocatable' attribute in the array </span>
<span style='color:#898887;'>!     declaration.  Storage is allocated via the 'allocate'</span>
<span style='color:#898887;'>!     statement, and freed with 'deallocate'.</span>
<span style='color:#898887;'>!===========================================================</span>
      <b>program</b>         arraydemo90

      <b>implicit</b>        <b>none</b>

      <span style='color:#0057ae;'>integer</span>         iargc,    i4arg

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Identify a1, a2 and a3 as rank-2 allocatable arrays.</span>
<span style='color:#898887;'>!</span>
<span style='color:#898887;'>!     Alternate equivalent declaration:</span>
<span style='color:#898887;'>!</span>
<span style='color:#898887;'>!     real*8, allocatable:: a1(:,:), a2(:,:), a3(:,:)</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>real*8</span>,  <span style='color:#0057ae;'>allocatable</span>, <span style='color:#0057ae;'>dimension( : , : )</span> <span style='color:#0057ae;'>::</span>
     <b>&amp;</b>                a1,       a2,       a3

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Run-time array bounds.</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         n1,       n2

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Get the desired array bounds from the command-line </span>
<span style='color:#898887;'>!     and perform superficial check for validity.</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>if</b>( iargc() <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>2</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
      n1 <b>=</b> i4arg(<span style='color:#b08000;'>1</span>,<b>-</b><span style='color:#b08000;'>1</span>)
      n2 <b>=</b> i4arg(<span style='color:#b08000;'>2</span>,<b>-</b><span style='color:#b08000;'>1</span>)
      <b>if</b>( n1 <b><span style='color:#008000;'>.le.</span></b> <span style='color:#b08000;'>0</span>  <b><span style='color:#008000;'>.or.</span></b>  n2 <b><span style='color:#008000;'>.le.</span></b>  <span style='color:#b08000;'>0</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Allocate the arrays</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>allocate</b>( a1(n1,n2) )
      <b>allocate</b>( a2(n1,n2) )
      <b>allocate</b>( a3(n1,n2) )

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Define and manipulate the 2-d arrays using various </span>
<span style='color:#898887;'>!     subroutines.</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>call</b> load2d( a1, n1, n2,  <span style='color:#b08000;'>1.0d0</span> )
      <b>call</b> load2d( a2, n1, n2, <b>-</b><span style='color:#b08000;'>1.0d0</span> )
      <b>call</b> add2d(  a1, a2, a3, n1, n2 )

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Dump the 3 arrays to standard error.</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>call</b> dump2d( a1, n1, n2, <span style='color:#bf0303;'>'a1'</span> )
      <b>call</b> dump2d( a2, n1, n2, <span style='color:#bf0303;'>'a2'</span> )
      <b>call</b> dump2d( a3, n1, n2, <span style='color:#bf0303;'>'a1 + a2'</span> )

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Deallocate the arrays</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>deallocate</b>(a1)
      <b>deallocate</b>(a2)
      <b>deallocate</b>(a3)
   
      <b>stop</b>

<span style='color:#b08000;'>900</span>   <b>continue</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'usage: arraydemo90 &lt;n1&gt; &lt;n2&gt;'</span>
      <b>stop</b>

      <b>end</b>

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Loads a 2-D array with the values:</span>
<span style='color:#898887;'>!</span>
<span style='color:#898887;'>!     a(i,j) = sc * (100 * j + i)</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>subroutine</b> load2d(a,d1,d2,sc)
         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>integer</span>       d1,        d2
         <span style='color:#0057ae;'>real*8</span>        a(d1,d2)
         <span style='color:#0057ae;'>real*8</span>        sc

         <span style='color:#0057ae;'>integer</span>       i,         j

         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , d2
            <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , d1
               a(i,j) <b>=</b> sc <b>*</b> (<span style='color:#b08000;'>100.0d0</span> <b>*</b> j <b>+</b> i)
            <b>end do</b>
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Adds 2-D arrays 'a1' and 'a2' element-wise and returns</span>
<span style='color:#898887;'>!     result in 'a3'</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>subroutine</b> add2d(a1,a2,a3,d1,d2)
         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>integer</span>       d1,        d2
         <span style='color:#0057ae;'>real*8</span>        a1(d1,d2), a2(d1,d2), a3(d1,d2)

         <span style='color:#0057ae;'>integer</span>       i,         j

         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , d2
            <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , d1
               a3(i,j) <b>=</b> a1(i,j) <b>+</b> a2(i,j)
            <b>end do</b>
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>!-----------------------------------------------------------</span>
<span style='color:#898887;'>!     Dumps 2-d array labelled with 'label' on stderr</span>
<span style='color:#898887;'>!-----------------------------------------------------------</span>
      <b>subroutine</b> dump2d(a,d1,d2,label)
         <b>implicit</b>       <b>none</b>

         <span style='color:#0057ae;'>integer</span>        d1,       d2
         <span style='color:#0057ae;'>real*8</span>         a(d1,d2)
         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)  label
         <span style='color:#0057ae;'>integer</span>        i,        j,        st
 
         <b>if</b>( d1 <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span>  <b><span style='color:#008000;'>.and.</span></b>  d2 <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#b08000;'>100</span><span style='color:#006060;'>)</span> label
 <span style='color:#b08000;'>100</span>        <span style='color:#006060;'>format(</span> <span style='color:#006060;'>/</span><span style='color:#bf0303;'>' &lt;&lt;&lt; '</span>,A,<span style='color:#bf0303;'>' &gt;&gt;&gt;'</span><span style='color:#006060;'>/)</span>
            <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , d2
               st <b>=</b> <span style='color:#b08000;'>1</span>
 <span style='color:#b08000;'>110</span>           <b>continue</b>
                  <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#b08000;'>120</span><span style='color:#006060;'>)</span> ( a(i,j) , i <b>=</b> st , <b><span style='color:#600060;'>min</span></b>(st<b>+</b><span style='color:#b08000;'>7</span>,d1))
 <span style='color:#b08000;'>120</span>              <span style='color:#006060;'>format(</span><span style='color:#bf0303;'>' '</span>,8F9.3<span style='color:#006060;'>)</span>
                  st <b>=</b> st <b>+</b> <span style='color:#b08000;'>8</span>
               <b>if</b>( st <b><span style='color:#008000;'>.le.</span></b> d1 ) <b>go</b> <b>to</b> <span style='color:#b08000;'>110</span>
               <b>if</b>( j <b><span style='color:#008000;'>.lt.</span></b> d2 ) <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span>
            <b>end do</b>
         <b>end if</b>

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     arraydemo.f:  Program which demonstrates manipulation</span>
<span style='color:#898887;'>c     of 'run-time' dimensioned arrays in Fortran. </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     The program accepts two integer arguments which </span>
<span style='color:#898887;'>c     specify the bounds for the two-dimensional arrays</span>
<span style='color:#898887;'>c     which are to be defined and manipulated.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     The basic guidelines are as follows:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c         (1) To deal with run-time defined dimensions,</span>
<span style='color:#898887;'>c             perform all array manipulation (including </span>
<span style='color:#898887;'>c             input and output) in SUBPROGRAMS rather </span>
<span style='color:#898887;'>c             that the main program.</span>
<span style='color:#898887;'>c </span>
<span style='color:#898887;'>c         (2) Always pass ALL bounds of an array, along </span>
<span style='color:#898887;'>c             with the array itself, to subprograms which</span>
<span style='color:#898887;'>c             are to manipulate the array.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c         (3) Declare sufficient storage in the main routine</span>
<span style='color:#898887;'>c             to deal with the largest array(s) you        </span>
<span style='color:#898887;'>c             anticipate dealing with, but make sure that </span>
<span style='color:#898887;'>c             you always check that the size of the storage </span>
<span style='color:#898887;'>c             is sufficient</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c         (4) An address of a location in a ONE dimensional</span>
<span style='color:#898887;'>c             array can be passed to a subprogram expecting </span>
<span style='color:#898887;'>c             a multi-dimensional array.  </span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         arraydemo

      <b>implicit</b>        <b>none</b>

      <span style='color:#0057ae;'>integer</span>         iargc,         i4arg
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Single-dimensioned array which can be used to provide</span>
<span style='color:#898887;'>c     storage for the multi-dimensional array manipulation.</span>
<span style='color:#898887;'>c     (&quot;Poor-man's memory allocation&quot;)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         maxq
      <span style='color:#0057ae;'>parameter</span>     ( maxq <b>=</b> <span style='color:#b08000;'>100</span> <span style='color:#b08000;'>000</span> )
      <span style='color:#0057ae;'>real*8</span>          q(maxq)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     'Pointer' to next available location in 'q'</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         qnext
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     'Pointers' for three 2-D arrays ('a1', 'a2', and 'a3')</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         narray
      <span style='color:#0057ae;'>parameter</span>     ( narray <b>=</b> <span style='color:#b08000;'>3</span> )

      <span style='color:#0057ae;'>integer</span>         a1,       a2,       a3
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Array bounds which are to be defined at run time</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <span style='color:#0057ae;'>integer</span>         n1,       n2

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Get the desired array bounds from the command-line </span>
<span style='color:#898887;'>c     and check that there is sufficient 'main-storage'.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>if</b>( iargc() <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>2</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
      n1 <b>=</b> i4arg(<span style='color:#b08000;'>1</span>,<b>-</b><span style='color:#b08000;'>1</span>)
      n2 <b>=</b> i4arg(<span style='color:#b08000;'>2</span>,<b>-</b><span style='color:#b08000;'>1</span>)
      <b>if</b>( n1 <b><span style='color:#008000;'>.le.</span></b> <span style='color:#b08000;'>0</span>  <b><span style='color:#008000;'>.or.</span></b>  n2 <b><span style='color:#008000;'>.le.</span></b>  <span style='color:#b08000;'>0</span> ) <b>go</b> <b>to</b> <span style='color:#b08000;'>900</span>
      <b>if</b>( narray <b>*</b> n1 <b>*</b> n2 <b><span style='color:#008000;'>.gt.</span></b> maxq ) <b>then</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'arraydemo: Insufficient main storage'</span>
         <b>stop</b>
      <b>end if</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Initialize the main storage pointer ...</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      qnext <b>=</b> <span style='color:#b08000;'>1</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     ... and set up the 'pointers' for the two arrays </span>
<span style='color:#898887;'>c     with bounds (n1,n2).</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      a1 <b>=</b> qnext
      qnext <b>=</b> qnext <b>+</b> n1 <b>*</b> n2
      a2 <b>=</b> qnext
      qnext <b>=</b> qnext <b>+</b> n1 <b>*</b> n2
      a3 <b>=</b> qnext
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Define and manipulate the 2-d arrays using various </span>
<span style='color:#898887;'>c     subroutines.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> load2d( q(a1), n1, n2,  <span style='color:#b08000;'>1.0d0</span> )
      <b>call</b> load2d( q(a2), n1, n2, <b>-</b><span style='color:#b08000;'>1.0d0</span> )
      <b>call</b> add2d(  q(a1), q(a2), q(a3), n1, n2 )

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Dump the 3 arrays to standard error.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>call</b> dump2d( q(a1), n1, n2, <span style='color:#bf0303;'>'a1'</span> )
      <b>call</b> dump2d( q(a2), n1, n2, <span style='color:#bf0303;'>'a2'</span> )
      <b>call</b> dump2d( q(a3), n1, n2, <span style='color:#bf0303;'>'a1 + a2'</span> )
   
      <b>stop</b>

<span style='color:#b08000;'>900</span>   <b>continue</b>
         <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'usage: arraydemo &lt;n1&gt; &lt;n2&gt;'</span>
      <b>stop</b>

      <b>end</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Loads a 2-D array with the values:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     a(i,j) = sc * (100 * j + i)</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>subroutine</b> load2d(a,d1,d2,sc)
         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>integer</span>       d1,        d2
         <span style='color:#0057ae;'>real*8</span>        a(d1,d2)
         <span style='color:#0057ae;'>real*8</span>        sc

         <span style='color:#0057ae;'>integer</span>       i,         j

         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , d2
            <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , d1
               a(i,j) <b>=</b> sc <b>*</b> (<span style='color:#b08000;'>100.0d0</span> <b>*</b> j <b>+</b> i)
            <b>end do</b>
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Adds 2-D arrays 'a1' and 'a2' element-wise and returns</span>
<span style='color:#898887;'>c     result in 'a3'</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>subroutine</b> add2d(a1,a2,a3,d1,d2)
         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>integer</span>       d1,        d2
         <span style='color:#0057ae;'>real*8</span>        a1(d1,d2), a2(d1,d2), a3(d1,d2)

         <span style='color:#0057ae;'>integer</span>       i,         j

         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , d2
            <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , d1
               a3(i,j) <b>=</b> a1(i,j) <b>+</b> a2(i,j)
            <b>end do</b>
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Dumps 2-d array labelled with 'label' on stderr</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
      <b>subroutine</b> dump2d(a,d1,d2,label)
         <b>implicit</b>       <b>none</b>

         <span style='color:#0057ae;'>integer</span>        d1,       d2
         <span style='color:#0057ae;'>real*8</span>         a(d1,d2)
         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)  label
         <span style='color:#0057ae;'>integer</span>        i,        j,        st
 
         <b>if</b>( d1 <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span>  <b><span style='color:#008000;'>.and.</span></b>  d2 <b><span style='color:#008000;'>.gt.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#b08000;'>100</span><span style='color:#006060;'>)</span> label
 <span style='color:#b08000;'>100</span>        <span style='color:#006060;'>format(</span> <span style='color:#006060;'>/</span><span style='color:#bf0303;'>' &lt;&lt;&lt; '</span>,A,<span style='color:#bf0303;'>' &gt;&gt;&gt;'</span><span style='color:#006060;'>/)</span>
            <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , d2
               st <b>=</b> <span style='color:#b08000;'>1</span>
 <span style='color:#b08000;'>110</span>           <b>continue</b>
                  <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#b08000;'>120</span><span style='color:#006060;'>)</span> ( a(i,j) , i <b>=</b> st , <b><span style='color:#600060;'>min</span></b>(st<b>+</b><span style='color:#b08000;'>7</span>,d1))
 <span style='color:#b08000;'>120</span>              <span style='color:#006060;'>format(</span><span style='color:#bf0303;'>' '</span>,8F9.3<span style='color:#006060;'>)</span>
                  st <b>=</b> st <b>+</b> <span style='color:#b08000;'>8</span>
               <b>if</b>( st <b><span style='color:#008000;'>.le.</span></b> d1 ) <b>go</b> <b>to</b> <span style='color:#b08000;'>110</span>
               <b>if</b>( j <b><span style='color:#008000;'>.lt.</span></b> d2 ) <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span>
            <b>end do</b>
         <b>end if</b>

         <b>return</b>

      <b>end</b>
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Program illustrating &quot;catastrophic&quot; loss of precision</span>
<span style='color:#898887;'>c     resulting from the subtraction of two nearly equal </span>
<span style='color:#898887;'>c     floating point values.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>program</b>         catprec

      <b>implicit</b>        <b>none</b>

      <span style='color:#0057ae;'>real*8</span>          x  
      <span style='color:#0057ae;'>parameter</span>     ( x <b>=</b> <span style='color:#b08000;'>0.2d0</span> )

      <span style='color:#0057ae;'>integer</span>         i
      <span style='color:#0057ae;'>real*8</span>          h,     dsinx

      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'      h      d(sin) approx   '</span><b>//</b>
     <b>&amp;</b>           <span style='color:#bf0303;'>'d(sin) exact    d(sin) err'</span>
      <span style='color:#006060;'>write(*</span>,<span style='color:#006060;'>*)</span>

      h <b>=</b> <span style='color:#b08000;'>0.5d0</span>
      <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , <span style='color:#b08000;'>16</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Algebraically, in the limit h -&gt; 0, dsinx should</span>
<span style='color:#898887;'>c        approach cos(x), but sin(x+h) -&gt; sin(x) so </span>
<span style='color:#898887;'>c        catastrophic loss of precision occurs.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         dsinx <b>=</b> (<b><span style='color:#600060;'>sin</span></b>(x<b>+</b>h) <b>-</b> <b><span style='color:#600060;'>sin</span></b>(x)) <b>/</b> h
         <span style='color:#006060;'>write(*</span>,<span style='color:#b08000;'>1000</span><span style='color:#006060;'>)</span> h,  dsinx,  <b><span style='color:#600060;'>cos</span></b>(x),   dsinx <b>-</b> <b><span style='color:#600060;'>cos</span></b>(x)
<span style='color:#b08000;'>1000</span>     <span style='color:#006060;'>format(</span>1P,E12.3,2E16.8,E12.3<span style='color:#006060;'>)</span>
         h <b>=</b> <span style='color:#b08000;'>0.125d0</span> <b>*</b> h
      <b>end do</b>

      <b>stop</b>

      <b>end</b> 
<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Implements matrix-matrix multiply </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     c = a b </span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     where a, b and c are n x n (square) real*8 matrices.</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> dmmmult(a,b,c,n)

         <b>implicit</b>         <b>none</b>

         <span style='color:#0057ae;'>integer</span>          n
         <span style='color:#0057ae;'>real*8</span>           a(n,n),    b(n,n),    c(n,n)

         <span style='color:#0057ae;'>integer</span>          i,     j,     k

         <b>do</b> j <b>=</b> <span style='color:#b08000;'>1</span> , n
            <b>do</b> i <b>=</b> <span style='color:#b08000;'>1</span> , n 
               c(i,j) <b>=</b> <span style='color:#b08000;'>0.0d0</span>
               <b>do</b> k <b>=</b> <span style='color:#b08000;'>1</span> , n
                  c(i,j) <b>=</b> c(i,j) <b>+</b> a(i,k) <b>*</b> b(k,j)
               <b>end do</b>
            <b>end do</b>
         <b>end do</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Writes a double precision matrix (two dimensional</span>
<span style='color:#898887;'>c     array) to file 'fname'.  If 'fname' is the</span>
<span style='color:#898887;'>c     string '-', the matrix is written to standard input.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     This routine is modelled on 'dvto' previously </span>
<span style='color:#898887;'>c     discussed in class: see ~phys410/f77/ex3/dvto.f</span>
<span style='color:#898887;'>c===========================================================</span>

      <b>subroutine</b> dmto(fname,a,d1,d2)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Arguments:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        fname:  (I)    File name</span>
<span style='color:#898887;'>c        a:      (I)    Input matrix</span>
<span style='color:#898887;'>c        d1:     (I)    First dimension of a </span>
<span style='color:#898887;'>c        d2:     (I)    Second dimension of a</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>implicit</b>         <b>none</b>

         <span style='color:#0057ae;'>integer</span>          indlnb,      getu

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)    fname
         <span style='color:#0057ae;'>integer</span>          d1,          d2
         <span style='color:#0057ae;'>real*8</span>           a(d1,d2)

         <span style='color:#0057ae;'>integer</span>          ustdout
         <span style='color:#0057ae;'>parameter</span>      ( ustdout <b>=</b> <span style='color:#b08000;'>6</span> )

         <span style='color:#0057ae;'>integer</span>          uto,         rc

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Parse fname: either &quot;attach&quot; 'uto' to stdout or </span>
<span style='color:#898887;'>c        get a unit number using 'getu', and open the </span>
<span style='color:#898887;'>c        file 'fname' for formatted I/O via 'uto'</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>if</b>( fname <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#bf0303;'>'-'</span> ) <b>then</b>
            uto <b>=</b> ustdout
         <b>else</b>
            uto <b>=</b> getu()
            <span style='color:#006060;'>open(</span>uto,<span style='color:#006060;'>file</span><b>=</b>fname(<span style='color:#b08000;'>1</span>:indlnb(fname)),
     <b>&amp;</b>           <span style='color:#006060;'>form</span><b>=</b><span style='color:#bf0303;'>'formatted'</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span>
            <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
               <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmto: Error opening '</span>,
     <b>&amp;</b>                    fname(<span style='color:#b08000;'>1</span>:indlnb(fname))
               <b>return</b>
            <b>end if</b>
         <b>end if</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Write dimensions, then array elements</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#006060;'>write(</span>uto,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span> d1, d2
         <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmto: Error writing dimensions'</span>
         <b>go</b> <b>to</b> <span style='color:#b08000;'>500</span>
         <b>end if</b>

         <span style='color:#006060;'>write(</span>uto,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span> a
         <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmto: Error reading matrix'</span>
         <b>end if</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Exit: Close file and return</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
 <span style='color:#b08000;'>500</span>     <b>continue</b>
         <b>if</b>( uto <b><span style='color:#008000;'>.ne.</span></b> ustdout ) <b>then</b>
            <span style='color:#006060;'>close(</span>uto<span style='color:#006060;'>)</span>
         <b>end if</b>

         <b>return</b>

         <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Returns a double precision matrix (two dimensional</span>
<span style='color:#898887;'>c     array) read from file 'fname'.  If 'fname' is the</span>
<span style='color:#898887;'>c     string '-', the matrix is read from standard input.</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     The dimensions of the matrix must precede the matrix </span>
<span style='color:#898887;'>c     elements themselves in the file.  Specifically, the </span>
<span style='color:#898887;'>c     file should have been created using the following </span>
<span style='color:#898887;'>c     list-directed, formatted READ statement </span>
<span style='color:#898887;'>c     (or equivalent):</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        integer      d1,    d2</span>
<span style='color:#898887;'>c        real*8       a(d1,d2)</span>
<span style='color:#898887;'>c        integer      uout</span>
<span style='color:#898887;'>c </span>
<span style='color:#898887;'>c        write(uout,*) d1, d2</span>
<span style='color:#898887;'>c        write(uout,*) a</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     This routine is modelled on 'dvfrom' previously </span>
<span style='color:#898887;'>c     discussed in class: see ~phys410/f77/ex3/dvfrom.f</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c     Note the use of helper routine 'dmfrom1' which </span>
<span style='color:#898887;'>c     reads actual array values once bounds have been </span>
<span style='color:#898887;'>c     extracted from file.</span>
<span style='color:#898887;'>c===========================================================</span>

      <b>subroutine</b> dmfrom(fname,a,d1,d2,asize)
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c     Arguments:</span>
<span style='color:#898887;'>c</span>
<span style='color:#898887;'>c        fname:  (I)    File name</span>
<span style='color:#898887;'>c        a:      (O)    Return matrix</span>
<span style='color:#898887;'>c        d1:     (O)    First dimension of a </span>
<span style='color:#898887;'>c        d2:     (O)    Second dimension of a</span>
<span style='color:#898887;'>c        asize:  (I)    Maximum size (d1 * d2) of a </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>implicit</b>         <b>none</b>

         <span style='color:#0057ae;'>integer</span>          indlnb,      getu

         <span style='color:#0057ae;'>character</span><b>*</b>(<b>*</b>)    fname
         <span style='color:#0057ae;'>integer</span>          d1,          d2,        asize
         <span style='color:#0057ae;'>real*8</span>           a(d1,d2)

         <span style='color:#0057ae;'>integer</span>          ustdin
         <span style='color:#0057ae;'>parameter</span>      ( ustdin <b>=</b> <span style='color:#b08000;'>5</span> )

         <span style='color:#0057ae;'>integer</span>          ufrom,       rc

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Parse fname: either &quot;attach&quot; 'ufrom' to stdin or </span>
<span style='color:#898887;'>c        get a unit number using 'getu', and open the </span>
<span style='color:#898887;'>c        file 'fname' for formatted I/O via 'ufrom'</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>if</b>( fname <b><span style='color:#008000;'>.eq.</span></b> <span style='color:#bf0303;'>'-'</span> ) <b>then</b>
            ufrom <b>=</b> ustdin
         <b>else</b>
            ufrom <b>=</b> getu()
            <span style='color:#006060;'>open(</span>ufrom,<span style='color:#006060;'>file</span><b>=</b>fname(<span style='color:#b08000;'>1</span>:indlnb(fname)),
     <b>&amp;</b>           <span style='color:#006060;'>form</span><b>=</b><span style='color:#bf0303;'>'formatted'</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc,<span style='color:#006060;'>status</span><b>=</b><span style='color:#bf0303;'>'old'</span><span style='color:#006060;'>)</span>
            <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
               <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmfrom: Error opening '</span>,
     <b>&amp;</b>                    fname(<span style='color:#b08000;'>1</span>:indlnb(fname))
               <b>return</b>
            <b>end if</b>
         <b>end if</b>

<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Read dimensions and abort if there is insufficient</span>
<span style='color:#898887;'>c        storage for the entire matrix.  Note the 'go to'</span>
<span style='color:#898887;'>c        to the 'exit block' since we've opened a file now</span>
<span style='color:#898887;'>c        and should close it, even if there's an error.</span>
<span style='color:#898887;'>c        Also, we set the dimensions to 0 for all error </span>
<span style='color:#898887;'>c        conditions as a way of communicating failure to </span>
<span style='color:#898887;'>c        the calling routine.</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <span style='color:#006060;'>read(</span>ufrom,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span> d1, d2
         <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmfrom: Error reading dimensions'</span>
            d1 <b>=</b> <span style='color:#b08000;'>0</span>
            d2 <b>=</b> <span style='color:#b08000;'>0</span>
         <b>go</b> <b>to</b> <span style='color:#b08000;'>500</span>
         <b>end if</b>
         <b>if</b>( (d1 <b>*</b> d2) <b><span style='color:#008000;'>.gt.</span></b> asize ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmfrom: Insufficient storage'</span>
            d1 <b>=</b> <span style='color:#b08000;'>0</span>
            d2 <b>=</b> <span style='color:#b08000;'>0</span>
         <b>go</b> <b>to</b> <span style='color:#b08000;'>500</span>
         <b>end if</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Now that dimensions have been determined call</span>
<span style='color:#898887;'>c        helper routine to read values </span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
         <b>call</b> dmfrom1(ufrom,a,d1,d2,rc)
         <b>if</b>( rc <b><span style='color:#008000;'>.ne.</span></b> <span style='color:#b08000;'>0</span> ) <b>then</b>
            <span style='color:#006060;'>write(</span><span style='color:#b08000;'>0</span>,<span style='color:#006060;'>*)</span> <span style='color:#bf0303;'>'dmfrom: Error reading matrix'</span>
            d1 <b>=</b> <span style='color:#b08000;'>0</span>
            d2 <b>=</b> <span style='color:#b08000;'>0</span>
         <b>end if</b>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
<span style='color:#898887;'>c        Exit: Close file and return</span>
<span style='color:#898887;'>c-----------------------------------------------------------</span>
 <span style='color:#b08000;'>500</span>     <b>continue</b>
         <b>if</b>( ufrom <b><span style='color:#008000;'>.ne.</span></b> ustdin ) <b>then</b>
            <span style='color:#006060;'>close(</span>ufrom<span style='color:#006060;'>)</span>
         <b>end if</b>

         <b>return</b>

      <b>end</b>

<span style='color:#898887;'>c===========================================================</span>
<span style='color:#898887;'>c     Helper routine for dmfrom: Reads array values, returns</span>
<span style='color:#898887;'>c     I/O status to calling routine via 'rc'</span>
<span style='color:#898887;'>c===========================================================</span>
      <b>subroutine</b> dmfrom1(ufrom,a,d1,d2,rc)

         <b>implicit</b>      <b>none</b>

         <span style='color:#0057ae;'>integer</span>       d1,       d2,     ufrom,     rc
         <span style='color:#0057ae;'>real*8</span>        a(d1,d2)

         <span style='color:#006060;'>read(</span>ufrom,<span style='color:#006060;'>*</span>,<span style='color:#006060;'>iostat</span><b>=</b>rc<span style='color:#006060;'>)</span> a

         <b>return</b>

      <b>end</b>
</pre>

		      <div style="clear: both;"></div>
	         </div>
		      <hr />
	         <div class ="date">last update:   , </div>
	    <div class="footer">
           <p><a href="Home.html">Home</a>|<a href="Research.html">Research</a>|<a href="Contact.html">Contact</a>|<a href="Links.html">Links</a>|<a href="Misc.html">Misc</a>|<a href="sg">Template</a></p>

      </div>  
	    <div style="clear: both;">&nbsp;</div>
        </div> <!-- end content -->
	<!-- in class postandside -->

                 <!--in class postandside-->   
         <!--this line is for compatibility issues --><div style="clear: both;">&#160;</div> <!--Displacement --> 
     </div> <!--End of post and side -->

     <!-- in class page2 -->
     <div style="clear: both;">&nbsp;</div>
  </div> <!--End of Page2 -->
     <div style="clear: both;">&nbsp;</div>

</div> <!-- End of page -->
<!--this is end of the file -->
<!-- ~~~ This content is generated using sg web template ~~-->
<!-- ~~~ For more information visit: http://laplace.physics.ubc.ca/People/arman/sg ~~ -->
</body>
</html>
